leantime.ideasController=function(){var d=!1,c=function(){return{sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(o){o.style.display=""}),d==!0&&(d=!1,location.reload())},afterShowCont:function(){jQuery(".ideaModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(c())}}}},u=function(){jQuery(".ideaModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(c())},m=function(o){jQuery.nmManual(o,c)},f=function(){var o=document.querySelector("#ideaMason");if(!o)return;var n=new Packery(o,{itemSelector:".ticketBox",columnWidth:260,isResizable:!0});imagesLoaded(o).on("progress",function(){n.layout()});var l=o.querySelectorAll(".ticketBox");l.forEach(function(t){var r=new Draggabilly(t);r.on("dragStart",function(){t.classList.add("tilt"),e(t)}),r.on("dragEnd",function(){t.classList.remove("tilt"),t._moveHandler&&(document.removeEventListener("mousemove",t._moveHandler),delete t._moveHandler)}),n.bindDraggabillyEvents(r)});function e(t){var r=t.getBoundingClientRect().left,i=function(s){s.pageX>=r?(t.classList.add("right"),t.classList.remove("left")):(t.classList.add("left"),t.classList.remove("right")),r=s.pageX};document.addEventListener("mousemove",i),t._moveHandler=i}n.on("dragItemPositioned",a);function a(){var t=[],r=n.getItemElements();r.forEach(function(i,s){var w=s+1,L=i.getAttribute("data-value");t.push({id:L,sortIndex:w})}),fetch(leantime.appUrl+"/api/ideas",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({action:"ideaSort",payload:JSON.stringify(t)})})}},p=function(){},v=function(){document.querySelectorAll(".mainIdeaContent img").forEach(function(o){var n=document.createElement("a");n.href=o.getAttribute("src"),n.className="imageModal",o.parentElement.insertBefore(n,o),n.appendChild(o)}),jQuery(".imageModal").nyroModal()},y=function(o){if(o=="existing"){var n=document.querySelector("#newMilestone"),l=document.querySelector("#milestoneSelectors"),e=document.querySelector("#existingMilestone");n&&(n.style.display="none"),l&&(l.style.display="none"),e&&(e.style.display=""),u()}if(o=="new"){var n=document.querySelector("#newMilestone"),e=document.querySelector("#existingMilestone"),l=document.querySelector("#milestoneSelectors");n&&(n.style.display=""),e&&(e.style.display="none"),l&&(l.style.display="none"),u()}if(o=="hide"){var n=document.querySelector("#newMilestone"),e=document.querySelector("#existingMilestone"),l=document.querySelector("#milestoneSelectors");n&&(n.style.display="none"),e&&(e.style.display="none"),l&&(l.style.display="")}},g=function(){d=!0},h=function(){document.body.addEventListener("click",function(o){var n=o.target.closest(".userDropdown .dropdown-menu a");if(n){var l=n.getAttribute("data-value").split("_");if(n.getAttribute("data-label"),l.length==3){var e=l[0],a=l[1];l[2],fetch(leantime.appUrl+"/api/ideas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:e,author:a})}).then(function(){var t=document.querySelector("#userDropdownMenuLink"+e+" span.text span#userImage"+e+" img");t&&t.setAttribute("src",leantime.appUrl+"/api/users?profileImage="+a),leantime.toast.show({message:leantime.i18n.__("short_notifications.user_updated"),style:"success"})})}}})},S=function(){document.body.addEventListener("click",function(o){var n=o.target.closest(".statusDropdown .dropdown-menu a");if(n){var l=n.getAttribute("data-value").split("_"),e=n.getAttribute("data-label");if(l.length==3){var a=l[0],t=l[1],r=l[2];fetch(leantime.appUrl+"/api/ideas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:a,box:t})}).then(function(){var i=document.querySelector("#statusDropdownMenuLink"+a+" span.text");i&&(i.textContent=e);var s=document.querySelector("#statusDropdownMenuLink"+a);s&&(s.className=r+" dropdown-toggle f-left status"),leantime.toast.show({message:leantime.i18n.__("short_notifications.status_updated"),style:"success"})})}}})},b=function(){var o=document.documentElement.scrollHeight-320;document.querySelectorAll("#sortableIdeaKanban .column .contentInner").forEach(function(n){n.style.height=o+"px"})},M=function(o){document.querySelectorAll("#sortableIdeaKanban .ticketBox").forEach(function(e){e.addEventListener("mouseenter",function(){this.style.background="var(--kanban-card-hover)"}),e.addEventListener("mouseleave",function(){this.style.background="var(--kanban-card-bg)"})});function n(e){var a=e.querySelectorAll(":scope > .moveable"),t=[];return a.forEach(function(r){if(r.id){var i=r.id.indexOf("_");i!==-1&&t.push(r.id.substring(0,i)+"[]="+r.id.substring(i+1))}}),t.join("&")}document.querySelectorAll("#sortableIdeaKanban .contentInner").forEach(function(e){e._sortableInstance&&e._sortableInstance.destroy(),e._sortableInstance=new Sortable(e,{group:"idea-kanban",draggable:".moveable",ghostClass:"ui-state-highlight",filter:".portlet-toggle",animation:150,onStart:function(a){a.item.classList.add("tilt"),l(a.item)},onEnd:function(a){a.item.classList.remove("tilt"),a.item._moveHandler&&(document.removeEventListener("mousemove",a.item._moveHandler),delete a.item._moveHandler);for(var t={action:"statusUpdate",payload:{}},r=0;r<o.length;r++){var i=document.querySelector(".contentInner.status_"+o[r]);i&&(t.payload[o[r]]=n(i))}fetch(leantime.appUrl+"/api/ideas",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams(t)})}})});function l(e){var a=e.getBoundingClientRect().left,t=function(r){r.pageX>=a?(e.classList.add("right"),e.classList.remove("left")):(e.classList.add("left"),e.classList.remove("right")),a=r.pageX};document.addEventListener("mousemove",t),e._moveHandler=t}document.querySelectorAll(".portlet").forEach(function(e){var a=e.querySelector(".portlet-header");if(a){var t=document.createElement("span");t.className="portlet-toggle",a.prepend(t)}}),document.querySelectorAll(".portlet-toggle").forEach(function(e){e.addEventListener("click",function(){this.classList.toggle("expanded");var a=this.closest(".portlet").querySelector(".portlet-content");a&&(a.style.display=a.style.display==="none"?"":"none")})})};return{setCloseModal:g,toggleMilestoneSelectors:y,openModalManually:m,initMasonryWall:f,initBoardControlModal:p,initWallImageModals:v,initUserDropdown:h,initStatusDropdown:S,setKanbanHeights:b,initIdeaKanban:M}}();
