leantime.kanbanController=function(){var l=function(t){var n=t.closest(".quickaddContainer"),e=n.querySelector("[data-quickadd-form]"),i=e.querySelector("[data-quickadd-input]"),a=n.querySelector(".quickAddLink"),r=e.classList.contains("active");r?(e.classList.remove("active"),e.style.display="none",e.dataset.submitting="false",a.style.display="",a.setAttribute("aria-expanded","false")):(e.classList.add("active"),e.style.display="block",e.dataset.submitting="false",a.style.display="none",a.setAttribute("aria-expanded","true"),i.focus())},u=function(){document.addEventListener("keydown",function(t){var n=t.target;if(n.matches("[data-quickadd-input]")){var e=n.closest("[data-quickadd-form]");if(e.dataset.submitting==="true"){t.preventDefault();return}var i=e.querySelector("[data-stay-open-input]");if(t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),e.dataset.submitting="true",i.value="0",e.submit()),t.key==="Enter"&&t.shiftKey&&(t.preventDefault(),e.dataset.submitting="true",i.value="1",e.submit()),t.key==="Escape"){t.preventDefault();var a=e.closest(".quickaddContainer"),r=a.querySelector(".quickAddLink");l(r),n.value=""}}})},c=function(){document.addEventListener("click",function(t){var n=document.querySelectorAll("[data-quickadd-form].active");n.forEach(function(e){var i=e.closest(".quickaddContainer"),a=i.querySelector(".quickAddLink"),r=e.querySelector("[data-quickadd-input]"),o=e.contains(t.target)||a.contains(t.target);if(e.dataset.submitting!=="true")if(!o&&r.value.trim()!==""){var g=e.querySelector("[data-stay-open-input]");g.value="0",e.dataset.submitting="true",e.submit()}else o||l(a)})})},s=function(t){var n=t.querySelectorAll(".column .contentInner");if(n.length!==0){n.forEach(function(i){i.style.minHeight="",i.style.height=""});var e=0;n.forEach(function(i){var a=i.offsetHeight;a>e&&(e=a)}),e>0&&n.forEach(function(i){i.style.minHeight=e+"px"})}},w=function(t){var n=t.querySelectorAll(".column .contentInner");n.forEach(function(e){e.style.minHeight="",e.style.height=""})},d=function(){requestAnimationFrame(function(){requestAnimationFrame(function(){var t=document.querySelectorAll(".kanban-swimlane-content:not(.collapsed)");t.forEach(function(n){s(n)})})})},b=function(t){var n=document.getElementById("swimlane-row-"+t),e=document.querySelector('.kanban-swimlane-sidebar[data-swimlane-id="'+t+'"]'),i=document.getElementById("swimlane-content-"+t);if(!n||!e||!i){console.error("Swimlane elements not found for ID:",t);return}var a=e.getAttribute("aria-expanded")==="true",r=!a;e.setAttribute("aria-expanded",r.toString());var o=e.querySelector(".kanban-lane-chevron .material-symbols-outlined");o&&(o.textContent=r?"expand_more":"chevron_right"),n.setAttribute("data-expanded",r.toString()),r?(i.classList.remove("collapsed"),s(i)):(i.classList.add("collapsed"),s(i)),fetch(leantime.appUrl+"/api/submenu",{method:"POST",credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({submenu:"swimlane_"+t,state:r?"open":"closed"})})},f=function(){document.addEventListener("keydown",function(t){var n=t.target.closest("[data-swimlane-id]");if(n){var e=n.getAttribute("data-swimlane-id");if((t.key==="Enter"||t.key===" ")&&(t.preventDefault(),b(e)),t.key==="ArrowDown"||t.key==="ArrowUp"){t.preventDefault();var i=Array.from(document.querySelectorAll("[data-swimlane-id]")),a=i.indexOf(n);t.key==="ArrowDown"&&a<i.length-1?i[a+1].focus():t.key==="ArrowUp"&&a>0&&i[a-1].focus()}}})},m=function(){if(!(typeof tippy>"u")){var t={allowHTML:!0,placement:"top",arrow:!0,theme:"light-border",trigger:"mouseenter focus",delay:[500,0]},n=[".status-segment[data-tippy-content]",".time-indicator[data-tippy-content]",".kanban-lane-count[data-tippy-content]",".tshirt-icon[data-tippy-content]",".thermometer-icon[data-tippy-content]",".user-avatar[data-tippy-content]",".type-icon[data-tippy-content]",".sprint-icon[data-tippy-content]",".milestone-icon[data-tippy-content]",".swimlane-header-label[data-tippy-content]"];n.forEach(function(e){var i=document.querySelectorAll(e);i.length>0&&tippy(i,t)})}},p=function(){"ontouchstart"in window&&document.querySelectorAll(".widgettitle").forEach(function(t){t.addEventListener("click",function(n){n.target.closest(".dropdown-toggle, .dropdown-menu")||this.classList.toggle("count-visible")})})},v=function(){var t=document.querySelectorAll(".kanban-swimlane-content.collapsed");t.forEach(function(n){s(n)})},y=function(){var t=document.querySelectorAll(".kanban-swimlane-row");if(t.length!==0&&!(window.innerWidth<=768)){var n=120,e=function(){t.forEach(function(i){var a=i.querySelector(".kanban-swimlane-sidebar"),r=i.querySelector(".kanban-swimlane-sidebar-inner"),o=i.querySelector(".kanban-swimlane-sentinel");if(!(!a||!r||!o)){var g=o.getBoundingClientRect(),h=a.getBoundingClientRect(),S=g.top<n&&h.bottom>n+100;if(S){var k=n-h.top,q=h.height-r.offsetHeight-12;k=Math.min(k,Math.max(0,q)),a.classList.add("is-sticky"),r.style.transform="translateY("+k+"px)"}else a.classList.remove("is-sticky"),r.style.transform=""}})};window.addEventListener("scroll",e,{passive:!0}),e()}};return document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){u(),c(),f(),m(),y(),p(),v(),d()}):(u(),c(),f(),m(),y(),p(),v(),d()),{toggleQuickAdd:l,initQuickAddKeyboard:u,initClickOutsideSave:c,toggleSwimlane:b,initSwimlaneKeyboard:f,initProgressBarTooltips:m,equalizeColumnHeights:s,resetColumnHeights:w,initCollapsedColumnHeights:v,initExpandedColumnHeights:d,initStickySwimlaneSidebars:y,initMobileColumnCountToggle:p}}();
