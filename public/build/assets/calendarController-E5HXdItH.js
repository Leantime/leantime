leantime.calendarController=function(){var y=function(i){var o=new Date;o.getDate(),o.getMonth(),o.getFullYear();var r=jQuery("body").height()-260,t=jQuery("#calendar").fullCalendar({timeZone:leantime.i18n.__("usersettings.timezone"),height:r,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay,listDay"},titleFormat:{month:"MMMM yyyy",week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:"dddd, MMM d, yyyy"},columnFormat:{month:leantime.i18n.__("language.columnFormatMonth"),week:leantime.i18n.__("language.columnFormatWeek"),day:leantime.i18n.__("language.columnFormatday")},timeFormat:{"":leantime.dateHelper.getFormatFromSettings("timeformat","luxon")},isRTL:leantime.i18n.__("language.isRTL")=="false"?0:1,firstDay:leantime.i18n.__("language.firstDayOfWeek"),monthNames:leantime.i18n.__("language.monthNames").split(","),monthNamesShort:leantime.i18n.__("language.monthNamesShort").split(","),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),buttonText:{prev:"&laquo;",next:"&raquo;",prevYear:"&nbsp;&lt;&lt;&nbsp;",nextYear:"&nbsp;&gt;&gt;&nbsp;",today:leantime.i18n.__("buttons.today"),month:leantime.i18n.__("buttons.month"),week:leantime.i18n.__("buttons.week"),day:leantime.i18n.__("buttons.day")},select:function(n,a,l){var m=prompt(leantime.i18n.__("label.event_title"));m&&t.fullCalendar("renderEvent",{title:m,start:n,end:a,allDay:l},!0),t.fullCalendar("unselect")},events:i,eventColor:"#0866c6"})},c=function(){jQuery(document).ready(function(){Date.prototype.addDays=function(r){return this.setDate(this.getDate()+r),this},jQuery.datepicker.setDefaults({beforeShow:function(r){if(jQuery(r).attr("readonly"))return!1}});var i=leantime.dateHelper.getFormatFromSettings("dateformat","jquery");from=jQuery("#event_date_from").datepicker({numberOfMonths:1,dateFormat:leantime.dateHelper.getFormatFromSettings("dateformat","jquery"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL")==="true"?1:0,nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader"),firstDay:leantime.i18n.__("language.firstDayOfWeek")}).on("change",function(r){to.datepicker("option","minDate",o(this)),jQuery("#event_date_to").val()==""&&jQuery("#event_date_to").val(jQuery("#event_date_from").val())}),to=jQuery("#event_date_to").datepicker({numberOfMonths:1,dateFormat:leantime.dateHelper.getFormatFromSettings("dateformat","jquery"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL")==="true"?1:0,nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader"),firstDay:leantime.i18n.__("language.firstDayOfWeek")}).on("change",function(){from.datepicker("option","maxDate",o(this))});function o(r){var t;try{t=jQuery.datepicker.parseDate(i,r.value)}catch(n){t=null,console.log(n)}return t}})},g=function(){var i={sizes:{minW:400,minH:350},resizable:!0,autoSizable:!0,callbacks:{afterShowCont:function(){jQuery(".formModal").nyroModal(i)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(".exportModal").nyroModal(i)},p=function(i,o){let r=document.querySelector(i),t=leantime.dateHelper.getFormatFromSettings("dateformat","luxon"),n=leantime.dateHelper.getFormatFromSettings("timeformat","luxon");const a=new FullCalendar.Calendar(r,{timeZone:leantime.i18n.__("usersettings.timezone"),height:"calc(100% - 65px)",stickyHeaderDates:!0,initialView:o,eventStartEditable:!0,dayHeaderFormat:t,eventTimeFormat:n,slotLabelFormat:n,views:{multiMonthOneMonth:{type:"multiMonth",duration:{months:1},multiMonthTitleFormat:{month:"long",year:"numeric"},dayHeaderFormat:{weekday:"short"}},timeGridDay:{dayHeaders:!1},listWeek:{listDayFormat:{weekday:"long"},listDaySideFormat:leantime.dateHelper.getFormatFromSettings("dateformat","luxon")}},droppable:!0,eventSources,editable:!0,headerToolbar:!1,nowIndicator:!0,bootstrapFontAwesome:{close:"fa-times",prev:"fa-chevron-left",next:"fa-chevron-right",prevYear:"fa-angle-double-left",nextYear:"fa-angle-double-right"},eventDrop:function(e){e.event.extendedProps.enitityType=="ticket"?jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:e.event.extendedProps.enitityId,editFrom:luxon.DateTime.fromJSDate(e.event.start).toFormat(t),timeFrom:luxon.DateTime.fromJSDate(e.event.start).toFormat(n),editTo:luxon.DateTime.fromJSDate(e.event.end).toFormat(t),timeTo:luxon.DateTime.fromJSDate(e.event.end).toFormat(n)}}):e.event.extendedProps.enitityType=="event"&&jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/calendar",data:{id:e.event.extendedProps.enitityId,dateFrom:e.event.startStr,dateTo:e.event.endStr}})},eventResize:function(e){e.event.extendedProps.enitityType=="ticket"?jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:e.event.extendedProps.enitityId,editFrom:luxon.DateTime.fromJSDate(e.event.start).toFormat(t),timeFrom:luxon.DateTime.fromJSDate(e.event.start).toFormat(n),editTo:luxon.DateTime.fromJSDate(e.event.end).toFormat(t),timeTo:luxon.DateTime.fromJSDate(e.event.end).toFormat(n)}}):e.event.extendedProps.enitityType=="event"&&jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/calendar",data:{id:e.event.extendedProps.enitityId,dateFrom:e.event.startStr,dateTo:e.event.endStr}})},eventReceive:function(e){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:e.event.id,editFrom:luxon.DateTime.fromJSDate(e.event.start).toFormat(t),timeFrom:luxon.DateTime.fromJSDate(e.event.start).toFormat(n),editTo:luxon.DateTime.fromJSDate(e.event.end).toFormat(t),timeTo:luxon.DateTime.fromJSDate(e.event.end).toFormat(n)}})},eventDragStart:function(e){},eventDidMount:function(e){e.isDraggable===!1&&jQuery(e.el).addClass("locked"),e.event.extendedProps.location!=null&&e.event.extendedProps.location!=""&&e.event.extendedProps.location.indexOf("http")==0&&(jQuery(e.el).attr("href",e.event.extendedProps.location),jQuery(e.el).attr("target","_blank"))}});jQuery(document).ready(function(){jQuery("#yourToDoContainer").length>0&&l(jQuery("#yourToDoContainer")[0]),m(),a.scrollToTime(Date.now())});function l(e){var s=e;s&&new FullCalendar.ThirdPartyDraggable(s,{itemSelector:".draggable-todo",mirrorClass:"dragging-mirror",eventDragMinDistance:10,mirrorSelector:function(u){return u.closest(".ticketBox")},eventData:function(u){let d=jQuery(u).data("event");return{id:d.id,title:d.title,color:d.color,enitityType:"ticket",duration:"01:00",url:d.url}}}),a.scrollToTime(Date.now())}function m(){a.setOption("locale",leantime.i18n.__("language.code")),a.render(),a.scrollToTime(Date.now()),jQuery(".minCalendar .fc-prev-button").click(function(){a.prev(),a.getCurrentData()}),jQuery(".minCalendar .fc-next-button").click(function(){a.next()}),jQuery(".minCalendar .fc-today-button").click(function(){a.today()}),jQuery(".minCalendar .calendarViewSelect").on("click",function(e){console.log(jQuery(this).data("value")),a.changeView(jQuery(this).data("value")),jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/submenu",data:{submenu:"dashboardCalendarView",state:jQuery(this).data("value")}})}),jQuery(".day-button").on("click",function(){const e=jQuery(this).data("date");a.gotoDate(e),jQuery(".day-button").removeClass("active"),jQuery(this).addClass("active")})}htmx.onLoad(function(e){return e.id=="yourToDoContainer"&&l(e),r})};return{initCalendar:y,initEventDatepickers:c,initExportModal:g,initWidgetCalendar:p}}();
