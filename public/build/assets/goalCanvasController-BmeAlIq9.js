leantime.goalCanvasController=function(){var o="goal",u=function(){var e=2;jQuery("html").height()-320-20*e-25},s=!1,i=function(){return{sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),s==!0&&(s=!1,location.reload())},afterShowCont:function(){window.htmx.process("#global-modal-content"),jQuery("."+o+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+o+"CanvasMilestone .deleteMilestone").nyroModal(i())},beforeClose:function(){location.reload()}},titleFromIframe:!0}},l=function(){jQuery("."+o+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+o+"CanvasMilestone .deleteMilestone").nyroModal(i())},d=function(e){jQuery.nmManual(e,i)},p=function(e){e=="existing"&&(jQuery("#newMilestone, #milestoneSelectors").hide("fast"),jQuery("#existingMilestone").show(),l()),e=="new"&&(jQuery("#newMilestone").show(),jQuery("#existingMilestone, #milestoneSelectors").hide("fast"),l()),e=="hide"&&(jQuery("#newMilestone, #existingMilestone").hide("fast"),jQuery("#milestoneSelectors").show("fast"))},c=function(){s=!0},m=function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("_");if(jQuery(this).attr("data-label"),e.length==3){var a=e[0],t=e[1];e[2],jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/"+o+"canvas",data:{id:a,author:t}}).done(function(){jQuery("#userDropdownMenuLink"+a+" span.text span#userImage"+a+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+t),jQuery.growl({message:leantime.i18n.__("short_notifications.user_updated"),style:"success"})})}})},y=function(){jQuery("body").on("click",".statusDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("/"),a=jQuery(this).attr("data-label");if(e.length==2){var t=e[0],n=e[1],r=jQuery(this).attr("class");jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/"+o+"canvas",data:{id:t,status:n}}).done(function(){jQuery("#statusDropdownMenuLink"+t+" span.text").text(a),jQuery("#statusDropdownMenuLink"+t).removeClass().addClass(r+" dropdown-toggle f-left status "),jQuery.growl({message:leantime.i18n.__("short_notifications.status_updated")})})}})},f=function(){jQuery("body").on("click",".relatesDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("/"),a=jQuery(this).attr("data-label");if(e.length==2){var t=e[0],n=e[1],r=jQuery(this).attr("class");jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/"+o+"canvas",data:{id:t,relates:n}}).done(function(){jQuery("#relatesDropdownMenuLink"+t+" span.text").text(a),jQuery("#relatesDropdownMenuLink"+t).removeClass().addClass(r+" dropdown-toggle f-left relates "),jQuery.growl({message:leantime.i18n.__("short_notifications.relates_updated")})})}})},h=function(e,a,t){var n={type:"doughnut",data:{datasets:[{data:[a,t],backgroundColor:[leantime.dashboardController.chartColors.green,leantime.dashboardController.chartColors.grey],label:leantime.i18n.__("label.project_done")}],labels:[a+"%"]},options:{maintainAspectRatio:!0,responsive:!0,plugins:{legend:{position:"none"},title:{display:!1,text:"Complete"}},animation:{animateScale:!0,animateRotate:!0}}},r=document.getElementById(e).getContext("2d");_progressChart=new Chart(r,n)};return{setCloseModal:c,toggleMilestoneSelectors:p,openModalManually:d,initUserDropdown:m,initStatusDropdown:y,initRelatesDropdown:f,setRowHeights:u,initProgressChart:h}}();
