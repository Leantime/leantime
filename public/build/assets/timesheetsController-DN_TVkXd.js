leantime.timesheetsController=function(){var s=function(a){document.addEventListener("DOMContentLoaded",function(){var n=document.querySelector("#allTimesheetsTable");if(n){var e=jQuery("#allTimesheetsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")},buttons:{colvis:leantime.i18n.__("datatables.buttons.colvis"),csv:leantime.i18n.__("datatables.buttons.download")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,stateSave:!0,displayLength:100}),t=new jQuery.fn.dataTable.Buttons(e,{buttons:[{extend:"csvHtml5",title:leantime.i18n.__("label.filename_fileexport"),charset:"utf-8",bom:!0,exportOptions:{format:{body:function(i,c,d,o){return typeof o.dataset.order<"u"&&(i=o.dataset.order),i}}}},{extend:"colvis",columns:":not(.noVis)"}]}),l=document.querySelector("#tableButtons");l&&l.appendChild(t.container()[0]),jQuery("#allTimesheetsTable").on("column-visibility.dt",function(i,c,d,o){e.draw(!1)})}})},r=function(){var a={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(n){n.style.display=""})},afterShowCont:function(){jQuery(".editTimeModal").nyroModal(a)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(".editTimeModal").nyroModal(a)},u=function(){jQuery("#toggleAddHours").click(function(){var e=jQuery(".newEntryRow");e.toggle(),e.is(":visible")&&jQuery("#newEntryDate").focus()}),jQuery(".project-select").chosen(),jQuery(".ticket-select").chosen(),jQuery(".project-select").change(function(){jQuery(".ticket-select").removeAttr("selected"),jQuery(".ticket-select").val(""),jQuery(".ticket-select").trigger("liszt:updated"),jQuery(".ticket-select option").show(),jQuery("#ticketSelect .chosen-results li").show();var e=jQuery(this).find("option:selected").val();e&&(jQuery(".ticket-select option").not(".project_"+e).not('[value=""]').hide(),jQuery("#ticketSelect .chosen-results li").not(".project_"+e).hide()),jQuery(".ticket-select").chosen("destroy").chosen()}),jQuery(".ticket-select").change(function(){var e=jQuery(this).find("option:selected").attr("data-value");e&&(jQuery(".project-select option[value="+e+"]").attr("selected","selected"),jQuery(".project-select").trigger("liszt:updated"),jQuery(".ticket-select").chosen("destroy").chosen())}),jQuery("#newEntryDate").datepicker({dateFormat:leantime.dateHelper.getFormatFromSettings("dateformat","jquery"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),monthNamesShort:leantime.i18n.__("language.monthNamesShort").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL")==="true"?1:0,nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader"),firstDay:1,onSelect:function(e,t){a()}});function a(){var e=jQuery("#newEntryDate").val(),t=jQuery(".kind-select").val()||"GENERAL_BILLABLE";if(e){var l=jQuery("#newEntryDate").datepicker("getDate"),i=Math.floor(l.getTime()/1e3);jQuery("#newEntryHours").attr("name","new|"+t+"|"+e+"|"+i)}else jQuery("#newEntryHours").attr("name","new|"+t+"|false|false")}jQuery(".kind-select").change(function(){a()});function n(){var e=0;jQuery("#myTimesheetList .hourCell").each(function(){var t=parseFloat(jQuery(this).val());isNaN(t)||(e=Math.round((e+t)*100)/100)}),jQuery("#listTotalHours").text(e)}jQuery("#myTimesheetList").on("change keyup",".hourCell",function(){n()})};return{initTimesheetsTable:s,initEditTimeModal:r,initMyListEditable:u}}();
