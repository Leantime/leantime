leantime.canvasController=function(){var c="",C=function(t){c=t},A=function(){window.addEventListener("load",function(){document.querySelectorAll(".loading").forEach(function(t){t.style.display="none"}),document.querySelectorAll(".filterBar .row-fluid").forEach(function(t){t.style.opacity="1"})})},E=function(){},w=!1,h={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(t){t.style.display=""}),w==!0&&(w=!1,location.reload())},afterShowCont:function(){window.htmx.process("#global-modal-content"),jQuery("."+c+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+c+"CanvasMilestone .deleteMilestone").nyroModal(h)},beforeClose:function(){location.reload()}},titleFromIframe:!0},M=function(){jQuery("."+c+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+c+"CanvasMilestone .deleteMilestone").nyroModal(h)},x=function(t){jQuery.nmManual(t,h)},q=function(t){if(t=="existing"){document.querySelectorAll("#newMilestone, #milestoneSelectors").forEach(function(o){o.style.display="none"});var e=document.getElementById("existingMilestone");e&&(e.style.display=""),M()}if(t=="new"){var n=document.getElementById("newMilestone");n&&(n.style.display=""),document.querySelectorAll("#existingMilestone, #milestoneSelectors").forEach(function(o){o.style.display="none"}),M()}if(t=="hide"){document.querySelectorAll("#newMilestone, #existingMilestone").forEach(function(o){o.style.display="none"});var l=document.getElementById("milestoneSelectors");l&&(l.style.display="")}},L=function(){w=!0},g=function(){document.body.addEventListener("click",function(t){var e=t.target.closest(".userDropdown .dropdown-menu a");if(e){var n=e.getAttribute("data-value").split("_");if(e.getAttribute("data-label"),n.length==3){var l=n[0],o=n[1];n[2],fetch(leantime.appUrl+"/api/"+c+"canvas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:l,author:o})}).then(function(){var i=document.querySelector("#userDropdownMenuLink"+l+" span.text span#userImage"+l+" img");i&&i.setAttribute("src",leantime.appUrl+"/api/users?profileImage="+o),leantime.toast.show({message:leantime.i18n.__("short_notifications.user_updated"),style:"success"})})}}})},S=function(){document.body.addEventListener("click",function(t){var e=t.target.closest(".statusDropdown .dropdown-menu a");if(e){var n=e.getAttribute("data-value").split("/"),l=e.getAttribute("data-label");if(n.length==2){var o=n[0],i=n[1],d=e.getAttribute("class");fetch(leantime.appUrl+"/api/"+c+"canvas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:o,status:i})}).then(function(){var f=document.querySelector("#statusDropdownMenuLink"+o+" span.text");f&&(f.textContent=l);var s=document.getElementById("statusDropdownMenuLink"+o);s&&(s.className=d+" dropdown-toggle f-left status "),leantime.toast.show({message:leantime.i18n.__("short_notifications.status_updated")})})}}})},b=function(){document.body.addEventListener("click",function(t){var e=t.target.closest(".relatesDropdown .dropdown-menu a");if(e){var n=e.getAttribute("data-value").split("/"),l=e.getAttribute("data-label");if(n.length==2){var o=n[0],i=n[1],d=e.getAttribute("class");fetch(leantime.appUrl+"/api/"+c+"canvas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:o,relates:i})}).then(function(){var f=document.querySelector("#relatesDropdownMenuLink"+o+" span.text");f&&(f.textContent=l);var s=document.getElementById("relatesDropdownMenuLink"+o);s&&(s.className=d+" dropdown-toggle f-left relates "),leantime.toast.show({message:leantime.i18n.__("short_notifications.relates_updated")})})}}})},D=function(t,e){e=e||{};var n=t,l=!1,o=function(){return{sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(a){a.style.display=""}),l&&(l=!1,location.reload())},afterShowCont:function(){window.htmx.process("#global-modal-content"),jQuery("."+n+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+n+"CanvasMilestone .deleteMilestone").nyroModal(o())},beforeClose:function(){location.reload()}},titleFromIframe:!0}},i=function(){jQuery("."+n+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+n+"CanvasMilestone .deleteMilestone").nyroModal(o())},d;e.rowSelectors&&e.rowSelectors.length>0?d=function(){e.rowSelectors.forEach(function(a){var u=0;document.querySelectorAll("#"+a+" div.contentInner").forEach(function(r){r.offsetHeight>u&&(u=r.offsetHeight+35)}),document.querySelectorAll("#"+a+" .column .contentInner").forEach(function(r){r.style.height=u+"px"})})}:e.nbRows&&e.nbRows>0?d=function(){var a=e.nbRows,u=["firstRow","secondRow","thirdRow","fourthRow"],r=document.documentElement.offsetHeight-320-20*a;a===2&&(r-=25);for(var p=0;p<a&&p<u.length;p++){var m="#"+u[p],y=r/a;a>=3&&(y=r*.333),document.querySelectorAll(m+" div.contentInner").forEach(function(v){v.offsetHeight>y&&(y=v.offsetHeight+50)}),document.querySelectorAll(m+" .column .contentInner").forEach(function(v){v.style.height=y+"px"})}}:d=function(){};var f={setCloseModal:function(){l=!0},toggleMilestoneSelectors:function(a){if(a=="existing"){document.querySelectorAll("#newMilestone, #milestoneSelectors").forEach(function(m){m.style.display="none"});var u=document.getElementById("existingMilestone");u&&(u.style.display=""),i()}if(a=="new"){var r=document.getElementById("newMilestone");r&&(r.style.display=""),document.querySelectorAll("#existingMilestone, #milestoneSelectors").forEach(function(m){m.style.display="none"}),i()}if(a=="hide"){document.querySelectorAll("#newMilestone, #existingMilestone").forEach(function(m){m.style.display="none"});var p=document.getElementById("milestoneSelectors");p&&(p.style.display="")}},openModalManually:function(a){jQuery.nmManual(a,o)},initUserDropdown:g,initStatusDropdown:S,initRelatesDropdown:b,setRowHeights:d};if(e.extras)for(var s in e.extras)e.extras.hasOwnProperty(s)&&(f[s]=e.extras[s]);return f};return{setCanvasName:C,initFilterBar:A,initCanvasLinks:E,initUserDropdown:g,initStatusDropdown:S,initRelatesDropdown:b,setCloseModal:L,toggleMilestoneSelectors:q,openModalManually:x,createController:D}}();
