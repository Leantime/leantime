(function(t){var y=function(l,r){if(this.$element=t(l),this.type=this.$element.data("uploadtype")||(this.$element.find(".thumbnail").length>0?"image":"file"),this.$input=this.$element.find(":file"),this.$input.length!==0){this.name=this.$input.attr("name")||r.name,this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]'),this.$hidden.length===0&&(this.$hidden=t('<input type="hidden" />'),this.$element.prepend(this.$hidden)),this.$preview=this.$element.find(".fileupload-preview");var e=this.$preview.css("height");this.$preview.css("display")!="inline"&&e!="0px"&&e!="none"&&this.$preview.css("line-height",e),this.original={exists:this.$element.hasClass("fileupload-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()},this.$remove=this.$element.find('[data-dismiss="fileupload"]'),this.$element.find('[data-trigger="fileupload"]').on("click.fileupload",t.proxy(this.trigger,this)),this.listen()}};y.prototype={listen:function(){this.$input.on("change.fileupload",t.proxy(this.change,this)),t(this.$input[0].form).on("reset.fileupload",t.proxy(this.reset,this)),this.$remove&&this.$remove.on("click.fileupload",t.proxy(this.clear,this))},change:function(l,r){if(r!=="clear"){var e=l.target.files!==void 0?l.target.files[0]:l.target.value?{name:l.target.value.replace(/^.+\\/,"")}:null;if(!e){this.clear();return}if(this.$hidden.val(""),this.$hidden.attr("name",""),this.$input.attr("name",this.name),this.type==="image"&&this.$preview.length>0&&(typeof e.type<"u"?e.type.match("image.*"):e.name.match("\\.(gif|png|jpe?g)$"))&&typeof FileReader<"u"){var s=new FileReader,a=this.$preview,f=this.$element;s.onload=function(n){a.html('<img src="'+n.target.result+'" '+(a.css("max-height")!="none"?'style="max-height: '+a.css("max-height")+';"':"")+" />"),f.addClass("fileupload-exists").removeClass("fileupload-new")},s.readAsDataURL(e)}else this.$preview.text(e.name),this.$element.addClass("fileupload-exists").removeClass("fileupload-new")}},clear:function(l){if(this.$hidden.val(""),this.$hidden.attr("name",this.name),this.$input.attr("name",""),navigator.userAgent.match(/msie/i)){var r=this.$input.clone(!0);this.$input.after(r),this.$input.remove(),this.$input=r}else this.$input.val("");this.$preview.html(""),this.$element.addClass("fileupload-new").removeClass("fileupload-exists"),l&&(this.$input.trigger("change",["clear"]),l.preventDefault())},reset:function(l){this.clear(),this.$hidden.val(this.original.hiddenVal),this.$preview.html(this.original.preview),this.original.exists?this.$element.addClass("fileupload-exists").removeClass("fileupload-new"):this.$element.addClass("fileupload-new").removeClass("fileupload-exists")},trigger:function(l){this.$input.trigger("click"),l.preventDefault()}},t.fn.fileupload=function(l){return this.each(function(){var r=t(this),e=r.data("fileupload");e||r.data("fileupload",e=new y(this,l)),typeof l=="string"&&e[l]()})},t.fn.fileupload.Constructor=y,t(document).on("click.fileupload.data-api",'[data-provides="fileupload"]',function(l){var r=t(this);if(!r.data("fileupload")){r.fileupload(r.data());var e=t(l.target).closest('[data-dismiss="fileupload"],[data-trigger="fileupload"]');e.length>0&&(e.trigger("click.fileupload"),l.preventDefault())}})})(window.jQuery);(function(t){var y=new Array,l=new Array;t.fn.doAutosize=function(r){var e=t(this).data("minwidth"),s=t(this).data("maxwidth"),a="",f=t(this),n=t("#"+t(this).data("tester_id"));if(a!==(a=f.val())){var m=a.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">");n.html(m);var o=n.width(),u=o+r.comfortZone>=e?o+r.comfortZone:e,c=f.width(),v=u<c&&u>=e||u>e&&u<s;v&&f.width(u)}},t.fn.resetAutosize=function(r){var e=t(this).data("minwidth")||r.minInputWidth||t(this).width(),s=t(this).data("maxwidth")||r.maxInputWidth||t(this).closest(".tagsinput").width()-r.inputPadding,a=t(this),f=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:a.css("fontSize"),fontFamily:a.css("fontFamily"),fontWeight:a.css("fontWeight"),letterSpacing:a.css("letterSpacing"),whiteSpace:"nowrap"}),n=t(this).attr("id")+"_autosize_tester";!t("#"+n).length>0&&(f.attr("id",n),f.appendTo("body")),a.data("minwidth",e),a.data("maxwidth",s),a.data("tester_id",n),a.css("width",e)},t.fn.addTag=function(r,e){return e=jQuery.extend({focus:!1,callback:!0},e),this.each(function(){var s=t(this).attr("id"),a=t(this).val().split(y[s]);if(a[0]==""&&(a=new Array),r=jQuery.trim(r),e.unique){var f=t(a).tagExist(r);f==!0&&t("#"+s+"_tag").addClass("not_valid")}else var f=!1;if(r!=""&&f!=!0){if(t("<span>").addClass("tag").append(t("<span>").text(r).append("  "),t("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return t("#"+s).removeTag(escape(r))})).insertBefore("#"+s+"_addTag"),a.push(r),t("#"+s+"_tag").val(""),e.focus?t("#"+s+"_tag").focus():t("#"+s+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,a),e.callback&&l[s]&&l[s].onAddTag){var n=l[s].onAddTag;n.call(this,r)}if(l[s]&&l[s].onChange){var m=a.length,n=l[s].onChange;n.call(this,t(this),a[m-1])}}}),!1},t.fn.removeTag=function(r){return r=unescape(r),this.each(function(){var e=t(this).attr("id"),s=t(this).val().split(y[e]);for(t("#"+e+"_tagsinput .tag").remove(),str="",i=0;i<s.length;i++)s[i]!=r&&(str=str+y[e]+s[i]);if(t.fn.tagsInput.importTags(this,str),l[e]&&l[e].onRemoveTag){var a=l[e].onRemoveTag;a.call(this,r)}}),!1},t.fn.tagExist=function(r){return jQuery.inArray(r,t(this))>=0},t.fn.importTags=function(r){id=t(this).attr("id"),t("#"+id+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,r)},t.fn.tagsInput=function(r){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},r);return this.each(function(){e.hide&&t(this).hide();var s=t(this).attr("id");(!s||y[t(this).attr("id")])&&(s=t(this).attr("id","tags"+new Date().getTime()).attr("id"));var a=jQuery.extend({pid:s,real_input:"#"+s,holder:"#"+s+"_tagsinput",input_wrapper:"#"+s+"_addTag",fake_input:"#"+s+"_tag"},e);y[s]=a.delimiter,(e.onAddTag||e.onRemoveTag||e.onChange)&&(l[s]=new Array,l[s].onAddTag=e.onAddTag,l[s].onRemoveTag=e.onRemoveTag,l[s].onChange=e.onChange);var f='<div id="'+s+'_tagsinput" class="tagsinput"><div id="'+s+'_addTag">';if(e.interactive&&(f=f+'<input id="'+s+'_tag" value="" data-default="'+e.defaultText+'" />'),f=f+'</div><div class="tags_clear"></div></div>',t(f).insertAfter(this),t(a.holder).css("width",e.width),t(a.holder).css("height",e.height),t(a.real_input).val()!=""&&t.fn.tagsInput.importTags(t(a.real_input),t(a.real_input).val()),e.interactive){if(t(a.fake_input).val(t(a.fake_input).attr("data-default")),t(a.fake_input).css("color",e.placeholderColor),t(a.fake_input).resetAutosize(e),t(a.holder).bind("click",a,function(n){t(n.data.fake_input).focus()}),t(a.fake_input).bind("focus",a,function(n){t(n.data.fake_input).val()==t(n.data.fake_input).attr("data-default")&&t(n.data.fake_input).val(""),t(n.data.fake_input).css("color","#000000")}),e.autocomplete_url!=null){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];jQuery.Autocompleter!==void 0?(t(a.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),t(a.fake_input).bind("result",a,function(n,m,o){m&&t("#"+s).addTag(m[0]+"",{focus:!0,unique:e.unique})})):jQuery.ui.autocomplete!==void 0&&(t(a.fake_input).autocomplete(autocomplete_options),t(a.fake_input).bind("autocompleteselect",a,function(n,m){return t(n.data.real_input).addTag(m.item.value,{focus:!0,unique:e.unique}),!1}))}else t(a.fake_input).bind("blur",a,function(n){var m=t(this).attr("data-default");return t(n.data.fake_input).val()!=""&&t(n.data.fake_input).val()!=m?n.data.minChars<=t(n.data.fake_input).val().length&&(!n.data.maxChars||n.data.maxChars>=t(n.data.fake_input).val().length)&&t(n.data.real_input).addTag(t(n.data.fake_input).val(),{focus:!0,unique:e.unique}):(t(n.data.fake_input).val(t(n.data.fake_input).attr("data-default")),t(n.data.fake_input).css("color",e.placeholderColor)),!1});t(a.fake_input).bind("keypress",a,function(n){if(n.which==n.data.delimiter.charCodeAt(0)||n.which==13)return n.preventDefault(),n.data.minChars<=t(n.data.fake_input).val().length&&(!n.data.maxChars||n.data.maxChars>=t(n.data.fake_input).val().length)&&t(n.data.real_input).addTag(t(n.data.fake_input).val(),{focus:!0,unique:e.unique}),t(n.data.fake_input).resetAutosize(e),!1;n.data.autosize&&t(n.data.fake_input).doAutosize(e)}),a.removeWithBackspace&&t(a.fake_input).bind("keydown",function(n){if(n.keyCode==8&&t(this).val()==""){n.preventDefault();var m=t(this).closest(".tagsinput").find(".tag:last").text(),o=t(this).attr("id").replace(/_tag$/,"");m=m.replace(/[\s]+x$/,""),t("#"+o).removeTag(escape(m)),t(this).trigger("focus")}}),t(a.fake_input).blur(),a.unique&&t(a.fake_input).keydown(function(n){(n.keyCode==8||String.fromCharCode(n.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&t(this).removeClass("not_valid")})}}),this},t.fn.tagsInput.updateTagsField=function(r,e){var s=t(r).attr("id");t(r).val(e.join(y[s]))},t.fn.tagsInput.importTags=function(r,e){t(r).val("");var s=t(r).attr("id"),a=e.split(y[s]);for(i=0;i<a.length;i++)t(r).addTag(a[i],{focus:!1,callback:!1});if(l[s]&&l[s].onChange){var f=l[s].onChange;f.call(r,r,a[i])}}})(jQuery);(function(){var t={allowedParents:{section:["root"],milestone:["section","milestone"],task:["section","milestone","task"],subtask:["task","subtask"]}};function y(o){return o&&o.dataset?o.dataset.itemType:null}function l(o){if(!o)return"root";if(o.dataset&&o.dataset.containerType)return o.dataset.containerType;if(o.dataset&&o.dataset.itemType)return o.dataset.itemType;var u=o.closest(".sortable-item");return u&&u.dataset.itemType||"root"}function r(o){return o&&o.dataset?o.dataset.project:null}function e(o,u){if(!o||!u)return!1;for(var c=u;c;){if(c===o)return!0;var v=c.parentElement?c.parentElement.closest(".sortable-item"):null;c=v}return!1}function s(o,u,c){var v=y(o),g=l(u);if(e(o,u))return!1;if(!c){var p=r(o),d=r(u);if(!d&&u&&u.parentElement){var w=u.parentElement.closest(".sortable-item");d=w?r(w):void 0}if(d!==void 0&&p!==d)return!1}var h=t.allowedParents[v];return!(!h||h.indexOf(g)===-1)}function a(o){var u=o.closest(".sortable-list[data-group-key]");return u?u.dataset.groupKey:null}function f(){var o=[],u="",c=document.getElementById("yourToDoContainer");c&&(u=c.dataset.groupBy||"");var v=[];u&&document.querySelectorAll(".sortable-item").forEach(function(d){var w=d.dataset.id,h=a(d),_=d.dataset.originalGroupKey;_&&h&&_!==h&&v.push({id:w,fromGroup:_,toGroup:h,groupBy:u})});function g(d,w,h){var _=d.querySelectorAll(":scope > .sortable-item");_.forEach(function(k,C){var $=k.dataset.id,x=a(k);o.push({id:$,parentId:w||null,parentType:l(k.parentElement),level:h,order:C,groupKey:x});var T=k.querySelector(":scope > .sortable-list");T&&g(T,$,h+1)})}if(document.querySelectorAll(".sortable-list").forEach(function(d){(!d.parentElement||!d.parentElement.closest(".sortable-list"))&&g(d,null,0)}),o.length>0){var p={};o.forEach(function(d,w){p[w]=JSON.stringify(d)}),v.length>0&&(v.forEach(function(d,w){p["groupChanges["+w+"]"]=JSON.stringify(d)}),p.groupBy=u),htmx.ajax("POST",leantime.appUrl+"/hx/widgets/myToDos/saveSorting",{target:"#htmx-indicator",swap:"none",values:p})}}function n(o){if(o){var u=o.classList.contains("sortable-list")?[o]:Array.from(o.querySelectorAll(".sortable-list"));o.classList.contains("sortable-list")&&u.indexOf(o)===-1&&u.push(o),u.forEach(function(c){c._sortableInstance&&c._sortableInstance.destroy(),c._sortableInstance=new Sortable(c,{group:"nested-sortable",animation:150,fallbackOnBody:!0,swapThreshold:.65,delay:150,delayOnTouchOnly:!0,draggable:".sortable-item",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",handle:".sortable-item",filter:".no-drag",forceFallback:!1,scroll:!0,scrollSensitivity:40,scrollSpeed:20,onStart:function(v){var g=v.item;document.querySelectorAll(".sortable-item").forEach(function(p){p.dataset.originalGroupKey||(p.dataset.originalGroupKey=a(p)||"")}),g.dataset.originalGroupKey=a(g)||"",g.dataset.startParentId=g.parentElement&&g.parentElement.id||""},onMove:function(v){var g=v.dragged,p=v.to;return s(g,p,!1)?(document.querySelectorAll(".highlight-drop-error").forEach(function(d){d.classList.remove("highlight-drop-error")}),document.querySelectorAll(".highlight-drop").forEach(function(d){d.classList.remove("highlight-drop")}),p.classList.add("highlight-drop"),!0):(p.classList.add("highlight-drop-error"),!1)},onEnd:function(v){var g=v.item;document.querySelectorAll(".highlight-drop, .highlight-drop-error").forEach(function(h){h.classList.remove("highlight-drop"),h.classList.remove("highlight-drop-error")}),document.querySelectorAll(".pomodoro-drop-target").forEach(function(h){h.classList.remove("pomodoro-drop-target")});var p=g.parentElement;if(!(!p||!p.classList.contains("sortable-list"))){if(!s(g,p,!0)){var d=document.getElementById(g.dataset.startParentId);d&&d.appendChild(g);var w="Nesting not allowed here";typeof leantime<"u"&&leantime.toast&&leantime.toast.show({message:w,style:"error"});return}setTimeout(function(){document.querySelectorAll(".sortable-list").forEach(function(h){if(h.querySelectorAll(":scope > .sortable-item").length===0){var _=h.parentElement;if(_&&_.classList.contains("sortable-item")){var k=_.querySelector(".accordion-toggle");k&&k.remove()}}})},300),f(),document.querySelectorAll(".sortable-item").forEach(function(h){delete h.dataset.originalGroupKey})}}})})}}var m=window.leantime||(window.leantime={});m.nestedSortable={init:n,saveSorting:f,isNestingAllowed:s},typeof jQuery<"u"&&(jQuery.fn.nestedSortable=function(){return this.each(function(){n(this)})})})();const A=window.jQuery;window.$=A;
