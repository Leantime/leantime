leantime.projectsController=function(){function p(){document.querySelectorAll("#sortableTicketKanban .column").forEach(function(e){var t=e.querySelectorAll(".moveable").length,o=e.querySelector(".count");o&&(o.textContent=t)})}var g=function(){jQuery(".projectDateFrom, .projectDateTo").datepicker({dateFormat:leantime.dateHelper.getFormatFromSettings("dateformat","jquery"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL")==="true"?1:0,nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")})},h=function(){var e={sizes:{minW:450,minH:350},resizable:!0,autoSizable:!0,callbacks:{afterShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(t){t.style.display=""}),g(),jQuery(".duplicateProjectModal, .formModal").nyroModal(e)},beforeClose:function(){location.reload()}}};jQuery(".duplicateProjectModal").nyroModal(e)},_=function(e){jQuery("#progressbar").progressbar({value:e})},y=function(){document.addEventListener("DOMContentLoaded",function(){jQuery("#allProjectsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,displayLength:100})})},b=function(e){var t=1,o=typeof e=="string"?document.querySelector(e):e;o.querySelectorAll("input.sorter").forEach(function(a){a.value=t,t++}),o._sortableInstance&&o._sortableInstance.destroy(),o._sortableInstance=new Sortable(o,{animation:150,onEnd:function(){t=1,o.querySelectorAll("input.sorter").forEach(function(a){a.value=t,t++})}})},S=function(){document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("#todosettings select.colorChosen").forEach(function(e){new SlimSelect({select:e,settings:{searchHighlight:!1}})})})},L=function(e){var t=document.querySelector("#todostatus-"+e);t&&t.parentElement&&t.parentElement.remove()},w=function(e){var t=-1;document.querySelectorAll("#todosettings ul .statusList").forEach(function(r){var l=r.querySelector(".labelKey");if(l){var c=l.value;parseInt(c)>=parseInt(t)&&(t=c)}});var o=parseInt(t)+1,a=document.querySelector(".newStatusTpl"),n=a.innerHTML.replaceAll("XXNEWKEYXX",o),s=document.querySelector("#todoStatusList");s.insertAdjacentHTML("beforeend","<li>"+n+"</li>"),document.querySelectorAll("#todosettings select.colorChosen").forEach(function(r){r.slim&&r.slim.destroy()}),leantime.projectsController.initSelectFields();var i=document.querySelector("#todoStatusList");i&&i._sortableInstance&&i._sortableInstance.destroy(),leantime.projectsController.initTodoStatusSortable("#todoStatusList")},d=null,q=function(e){if(v(),e.files&&e.files[0]){var t=new FileReader,o=document.querySelector("#projectAvatar");t.onload=function(a){d=new Croppie(o,{enableExif:!0,viewport:{width:200,height:200,type:"rectangle"},boundary:{width:250,height:250}}),d.bind({url:a.currentTarget.result});var n=document.querySelector("#previousImage");n&&(n.style.display="none")},t.readAsDataURL(e.files[0])}},v=function(){document.querySelector("#profileImg"),d&&(d.destroy(),d=null);var e=document.querySelector("#previousImage");e&&(e.style.display="")},T=function(){var e=document.querySelector("#save-picture");e&&e.classList.add("running");var t=document.querySelector("#profileImg");t&&t.setAttribute("src",leantime.appUrl+"/images/loaders/loader28.gif"),d.result({type:"blob",circle:!1}).then(function(o){var a=new FormData;a.append("file",o),fetch(leantime.appUrl+"/api/projects",{method:"POST",body:a,credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(n){e&&e.classList.remove("running"),location.reload()}).catch(function(n){console.log(n)})})},E=function(e,t,o){function a(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}document.addEventListener("DOMContentLoaded",function(){if(o===!1)var n=new Gantt("#gantt",e,{header_height:55,column_width:20,step:24,view_modes:["Day","Week","Month"],bar_height:40,static_progress_indicator:!0,bar_corner_radius:10,arrow_curve:10,padding:20,view_mode:"Month",date_format:leantime.i18n.__("language.momentJSDate"),language:"en",additional_rows:5,custom_popup_html:function(i){i._end;var r='<div class="details-container" style="min-width:600px;"> ';return i.projectName!==void 0&&(r+="<h3><b>"+i.name+"</b></h3>"),r+="<h4>"+a(i.name)+"</a></h4><br /> ",r+="</div>",r},on_click:function(i){},on_date_change:function(i,r,l){var c=i.id.split("-");let u=0,m="";c.length>1?c[0]=="ticket"?(u=c[1],m="ticket"):c[0]=="pgm"&&(u=c[1],m="project"):u=c,m=="ticket"?leantime.ticketsRepository.updateMilestoneDates(u,r,l,i._index+1):fetch(leantime.appUrl+"/api/projects",{method:"PATCH",body:new URLSearchParams({id:u,start:r,end:l,sortIndex:i._index+1}),credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}})},on_sort_change:function(i){for(var r={action:"ganttSort",payload:{}},l=0;l<i.length;l++)r.payload[i[l].id]=i[l]._index+1;fetch(leantime.appUrl+"/api/projects",{method:"POST",body:new URLSearchParams(f(r)),credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}})},on_progress_change:function(i,r){},on_view_change:function(i){leantime.usersRepository.updateUserViewSettings("projectGantt",i)},on_popup_show:function(i){}});else var n=new Gantt("#gantt",e,{readonlyGantt:!0,resizing:!1,progress:!1,is_draggable:!1,custom_popup_html:function(r){task._end;var l='<div class="details-container" style="min-width:600px;"> ';return task.projectName!==void 0&&(l+="<h3><b>"+r.name+"</b></h3>"),l+="<h4>"+a(r.name)+"</a></h4><br /> ",l+="</div>",l},on_click:function(r){},on_date_change:function(r,l,c){},on_progress_change:function(r,l){},on_view_change:function(r){leantime.usersRepository.updateUserViewSettings("projectGantt",r)}});var s=document.querySelector("#ganttTimeControl");s&&s.addEventListener("click",function(i){var r=i.target.closest("a");if(r){var l=r.getAttribute("data-value");n.change_view_mode(l),s.querySelectorAll("a").forEach(function(u){u.classList.remove("active")}),r.classList.add("active");var c=r.textContent;document.querySelectorAll(".viewText").forEach(function(u){u.textContent=c})}}),n.change_view_mode(t)})};function f(e,t){var o={};for(var a in e)if(e.hasOwnProperty(a)){var n=t?t+"["+a+"]":a;typeof e[a]=="object"&&e[a]!==null?Object.assign(o,f(e[a],n)):o[n]=e[a]}return o}var C=function(){document.addEventListener("DOMContentLoaded",function(){p();var e=document.querySelector(".filterBar .row-fluid");e&&(e.style.opacity="1");var t=document.documentElement.scrollHeight-250;document.querySelectorAll("#sortableProjectKanban .column .contentInner").forEach(function(o){o.offsetHeight>t&&(t=o.offsetHeight)}),t=t+50,document.querySelectorAll("#sortableProjectKanban .column .contentInner").forEach(function(o){o.style.minHeight=t+"px"})})},j=function(e){document.querySelectorAll("#sortableProjectKanban .projectBox").forEach(function(a){a.addEventListener("mouseenter",function(){this.style.background="var(--kanban-card-hover)"}),a.addEventListener("mouseleave",function(){this.style.background="var(--kanban-card-bg)"})});function t(a){var n=a.querySelectorAll(":scope > .moveable"),s=[];return n.forEach(function(i){if(i.id){var r=i.id.indexOf("_");r!==-1&&s.push(i.id.substring(0,r)+"[]="+i.id.substring(r+1))}}),s.join("&")}document.querySelectorAll("#sortableProjectKanban .contentInner").forEach(function(a){a._sortableInstance&&a._sortableInstance.destroy(),a._sortableInstance=new Sortable(a,{group:"project-kanban",draggable:".moveable",ghostClass:"ui-state-highlight",filter:".portlet-toggle, input, a, select, textarea",preventOnFilter:!1,animation:150,delay:25,delayOnTouchOnly:!0,onStart:function(n){n.item.classList.add("tilt"),o(n.item)},onEnd:function(n){n.item.classList.remove("tilt"),n.item._moveHandler&&(document.removeEventListener("mousemove",n.item._moveHandler),delete n.item._moveHandler),p();for(var s={action:"sortIndex",payload:{},handler:n.item.id},i=0;i<e.length;i++){var r=document.querySelector(".contentInner.status_"+e[i]);r&&(s.payload[e[i]]=t(r))}fetch(leantime.appUrl+"/api/projects",{method:"POST",body:new URLSearchParams(f(s)),credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}})}})});function o(a){var n=a.getBoundingClientRect().left,s=function(i){i.pageX>=n?(a.classList.add("right"),a.classList.remove("left")):(a.classList.add("left"),a.classList.remove("right")),n=i.pageX};document.addEventListener("mousemove",s),a._moveHandler=s}document.querySelectorAll(".portlet").forEach(function(a){a.classList.add("ui-widget","ui-widget-content","ui-helper-clearfix","ui-corner-all");var n=a.querySelector(".portlet-header");n&&(n.classList.add("ui-widget-header","ui-corner-all"),n.insertAdjacentHTML("afterbegin","<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>"))}),document.querySelectorAll(".portlet-toggle").forEach(function(a){a.addEventListener("click",function(){this.classList.toggle("ui-icon-minusthick"),this.classList.toggle("ui-icon-plusthick");var n=this.closest(".portlet").querySelector(".portlet-content");n&&(n.style.display=n.style.display==="none"?"":"none")})})},x=function(e,t){t.classList.add("go"),t.classList.contains("isFavorite")?leantime.reactionsController.removeReaction("project",e,"favorite",function(){var o=t.querySelector("i");o&&(o.classList.remove("fa-solid"),o.classList.add("fa-regular")),t.classList.remove("isFavorite")}):leantime.reactionsController.addReactions("project",e,"favorite",function(){var o=t.querySelector("i");o&&(o.classList.remove("fa-regular"),o.classList.add("fa-solid")),t.classList.add("isFavorite")})};return{initDates:g,initProgressBar:_,initProjectTable:y,initDuplicateProjectModal:h,initTodoStatusSortable:b,initSelectFields:S,removeStatus:L,addToDoStatus:w,saveCroppie:T,clearCroppie:v,readURL:q,initGanttChart:E,setUpKanbanColumns:C,initProjectsKanban:j,favoriteProject:x}}();
