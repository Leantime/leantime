leantime.projectsController=function(){function d(){jQuery("#sortableTicketKanban .column").each(function(){var e=jQuery(this).find(".moveable").length;jQuery(this).find(" .count").text(e)})}var p=function(){jQuery(".projectDateFrom, .projectDateTo").datepicker({dateFormat:leantime.dateHelper.getFormatFromSettings("dateformat","jquery"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL")==="true"?1:0,nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")})},m=function(){jQuery(".projectTabs").tabs()},f=function(){var e={sizes:{minW:450,minH:350},resizable:!0,autoSizable:!0,callbacks:{afterShowCont:function(){jQuery(".showDialogOnLoad").show(),p(),jQuery(".duplicateProjectModal, .formModal").nyroModal(e)},beforeClose:function(){location.reload()}}};jQuery(".duplicateProjectModal").nyroModal(e)},h=function(e){jQuery("#progressbar").progressbar({value:e})},_=function(){jQuery(document).ready(function(){jQuery("#allProjectsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,displayLength:100})})},y=function(e){var a=1;jQuery(e).find("input.sorter").each(function(n){jQuery(this).val(a),a++}),jQuery(e).sortable({stop:function(n,i){a=1,jQuery(e).find("input.sorter").each(function(o){jQuery(this).val(a),a++})}})},v=function(){jQuery(document).ready(function(){jQuery("#todosettings select.colorChosen").on("chosen:ready",function(e,a){var n=jQuery(this).attr("id").replace("-","_");jQuery("#"+n+"_chosen a span").removeClass(),jQuery("#"+n+"_chosen a span").addClass(a.selected)}).chosen({disable_search_threshold:10}),jQuery("#todosettings select.colorChosen").on("change",function(e,a){var n=jQuery(this).attr("id").replace("-","_");jQuery("#"+n+"_chosen a span").removeClass(),jQuery("#"+n+"_chosen a span").addClass(a.selected)})})},j=function(e){jQuery("#todostatus-"+e).parent().remove()},b=function(e){var a=-1;jQuery("#todosettings ul .statusList").each(function(){var o=jQuery(this).find(".labelKey").val();parseInt(o)>=parseInt(a)&&(a=o)});var n=parseInt(a)+1,i=jQuery(".newStatusTpl").clone();i.html(function(o,t){return updatedContent=t.replaceAll("XXNEWKEYXX",n)}),jQuery("#todoStatusList").append("<li>"+i.html()+"</li>"),jQuery("#todosettings select.colorChosen").chosen("destroy"),leantime.projectsController.initSelectFields(),jQuery("#todoStatusList").sortable("destroy"),leantime.projectsController.initTodoStatusSortable("#todoStatusList")},Q=function(e){if(g(),e.files&&e.files[0]){var a=new FileReader,n=jQuery("#projectAvatar");a.onload=function(i){_uploadResult=n.croppie({enableExif:!0,viewport:{width:200,height:200,type:"rectangle"},boundary:{width:250,height:250}}),_uploadResult.croppie("bind",{url:i.currentTarget.result}),jQuery("#previousImage").hide()},a.readAsDataURL(e.files[0])}},g=function(){jQuery("#profileImg").croppie("destroy"),jQuery("#previousImage").show()},C=function(){jQuery("#save-picture").addClass("running"),jQuery("#profileImg").attr("src",leantime.appUrl+"/images/loaders/loader28.gif"),_uploadResult.croppie("result",{type:"blob",circle:!1}).then(function(e){var a=new FormData;a.append("file",e),jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/projects",data:a,processData:!1,contentType:!1,success:function(n){jQuery("#save-picture").removeClass("running"),location.reload()},error:function(n){console.log(n)}})})},T=function(e,a,n){function i(o){return String(o).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}jQuery(document).ready(function(){if(n===!1)var o=new Gantt("#gantt",e,{header_height:55,column_width:20,step:24,view_modes:["Day","Week","Month"],bar_height:40,static_progress_indicator:!0,bar_corner_radius:10,arrow_curve:10,padding:20,view_mode:"Month",date_format:leantime.i18n.__("language.momentJSDate"),language:"en",additional_rows:5,custom_popup_html:function(t){t._end;var r='<div class="details-container" style="min-width:600px;"> ';return t.projectName!==void 0&&(r+="<h3><b>"+t.name+"</b></h3>"),r+="<h4>"+i(t.name)+"</a></h4><br /> ",r+="</div>",r},on_click:function(t){},on_date_change:function(t,r,s){var l=t.id.split("-");let c=0,u="";l.length>1?l[0]=="ticket"?(c=l[1],u="ticket"):l[0]=="pgm"&&(c=l[1],u="project"):c=l,u=="ticket"?leantime.ticketsRepository.updateMilestoneDates(c,r,s,t._index+1):jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/projects",data:{id:c,start:r,end:s,sortIndex:t._index+1}}).done(function(){})},on_sort_change:function(t){for(var r={action:"ganttSort",payload:{}},s=0;s<t.length;s++)r.payload[t[s].id]=t[s]._index+1;jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/projects",data:r})},on_progress_change:function(t,r){},on_view_change:function(t){leantime.usersRepository.updateUserViewSettings("projectGantt",t)},on_popup_show:function(t){}});else var o=new Gantt("#gantt",e,{readonlyGantt:!0,resizing:!1,progress:!1,is_draggable:!1,custom_popup_html:function(r){task._end;var s='<div class="details-container" style="min-width:600px;"> ';return task.projectName!==void 0&&(s+="<h3><b>"+r.name+"</b></h3>"),s+="<h4>"+i(r.name)+"</a></h4><br /> ",s+="</div>",s},on_click:function(r){},on_date_change:function(r,s,l){},on_progress_change:function(r,s){},on_view_change:function(r){leantime.usersRepository.updateUserViewSettings("projectGantt",r)}});jQuery("#ganttTimeControl").on("click","a",function(){var t=jQuery(this),r=t.attr("data-value");o.change_view_mode(r),t.parent().parent().find("a").removeClass("active"),t.addClass("active");var s=t.text();jQuery(".viewText").text(s)}),o.change_view_mode(a)})},x=function(){jQuery(document).ready(function(){d(),jQuery(".filterBar .row-fluid").css("opacity","1");var e=jQuery("html").height()-250;jQuery("#sortableProjectKanban .column .contentInner").each(function(){jQuery(this).height()>e&&(e=jQuery(this).height())}),e=e+50,jQuery("#sortableProjectKanban .column .contentInner").css("min-height",e)})},w=function(e){jQuery("#sortableProjectKanban .projectBox").hover(function(){jQuery(this).css("background","var(--kanban-card-hover)")},function(){jQuery(this).css("background","var(--kanban-card-bg)")}),jQuery("#sortableProjectKanban .contentInner").sortable({connectWith:".contentInner",items:"> .moveable",tolerance:"intersect",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,cancel:".portlet-toggle,:input,a,input",distance:25,start:function(n,i){i.item.addClass("tilt"),a(i.item)},stop:function(n,i){i.item.removeClass("tilt"),jQuery("html").unbind("mousemove",i.item.data("move_handler")),i.item.removeData("move_handler"),d();for(var o={action:"sortIndex",payload:{},handler:i.item[0].id},t=0;t<e.length;t++)jQuery(".contentInner.status_"+e[t]).length&&(o.payload[e[t]]=jQuery(".contentInner.status_"+e[t]).sortable("serialize"));jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/projects",data:o})}});function a(n){var i=n.position().left,o=function(t){t.pageX>=i?(n.addClass("right"),n.removeClass("left")):(n.addClass("left"),n.removeClass("right")),i=t.pageX};jQuery("html").bind("mousemove",o),n.data("move_handler",o)}jQuery(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>"),jQuery(".portlet-toggle").click(function(){var n=jQuery(this);n.toggleClass("ui-icon-minusthick ui-icon-plusthick"),n.closest(".portlet").find(".portlet-content").toggle()})},S=function(e,a){jQuery(a).addClass("go"),jQuery(a).hasClass("isFavorite")?leantime.reactionsController.removeReaction("project",e,"favorite",function(){jQuery(a).find("i").removeClass("fa-solid").addClass("fa-regular"),jQuery(a).removeClass("isFavorite")}):leantime.reactionsController.addReactions("project",e,"favorite",function(){jQuery(a).find("i").removeClass("fa-regular").addClass("fa-solid"),jQuery(a).addClass("isFavorite")})};return{initDates:p,initProjectTabs:m,initProgressBar:h,initProjectTable:_,initDuplicateProjectModal:f,initTodoStatusSortable:y,initSelectFields:v,removeStatus:j,addToDoStatus:b,saveCroppie:C,clearCroppie:g,readURL:Q,initGanttChart:T,setUpKanbanColumns:x,initProjectsKanban:w,favoriteProject:S}}();
