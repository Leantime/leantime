(function(e){var v=function(l,s){if(this.$element=e(l),this.type=this.$element.data("uploadtype")||(this.$element.find(".thumbnail").length>0?"image":"file"),this.$input=this.$element.find(":file"),this.$input.length!==0){this.name=this.$input.attr("name")||s.name,this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]'),this.$hidden.length===0&&(this.$hidden=e('<input type="hidden" />'),this.$element.prepend(this.$hidden)),this.$preview=this.$element.find(".fileupload-preview");var r=this.$preview.css("height");this.$preview.css("display")!="inline"&&r!="0px"&&r!="none"&&this.$preview.css("line-height",r),this.original={exists:this.$element.hasClass("fileupload-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()},this.$remove=this.$element.find('[data-dismiss="fileupload"]'),this.$element.find('[data-trigger="fileupload"]').on("click.fileupload",e.proxy(this.trigger,this)),this.listen()}};v.prototype={listen:function(){this.$input.on("change.fileupload",e.proxy(this.change,this)),e(this.$input[0].form).on("reset.fileupload",e.proxy(this.reset,this)),this.$remove&&this.$remove.on("click.fileupload",e.proxy(this.clear,this))},change:function(l,s){if(s!=="clear"){var r=l.target.files!==void 0?l.target.files[0]:l.target.value?{name:l.target.value.replace(/^.+\\/,"")}:null;if(!r){this.clear();return}if(this.$hidden.val(""),this.$hidden.attr("name",""),this.$input.attr("name",this.name),this.type==="image"&&this.$preview.length>0&&(typeof r.type<"u"?r.type.match("image.*"):r.name.match("\\.(gif|png|jpe?g)$"))&&typeof FileReader<"u"){var a=new FileReader,n=this.$preview,d=this.$element;a.onload=function(t){n.html('<img src="'+t.target.result+'" '+(n.css("max-height")!="none"?'style="max-height: '+n.css("max-height")+';"':"")+" />"),d.addClass("fileupload-exists").removeClass("fileupload-new")},a.readAsDataURL(r)}else this.$preview.text(r.name),this.$element.addClass("fileupload-exists").removeClass("fileupload-new")}},clear:function(l){if(this.$hidden.val(""),this.$hidden.attr("name",this.name),this.$input.attr("name",""),navigator.userAgent.match(/msie/i)){var s=this.$input.clone(!0);this.$input.after(s),this.$input.remove(),this.$input=s}else this.$input.val("");this.$preview.html(""),this.$element.addClass("fileupload-new").removeClass("fileupload-exists"),l&&(this.$input.trigger("change",["clear"]),l.preventDefault())},reset:function(l){this.clear(),this.$hidden.val(this.original.hiddenVal),this.$preview.html(this.original.preview),this.original.exists?this.$element.addClass("fileupload-exists").removeClass("fileupload-new"):this.$element.addClass("fileupload-new").removeClass("fileupload-exists")},trigger:function(l){this.$input.trigger("click"),l.preventDefault()}},e.fn.fileupload=function(l){return this.each(function(){var s=e(this),r=s.data("fileupload");r||s.data("fileupload",r=new v(this,l)),typeof l=="string"&&r[l]()})},e.fn.fileupload.Constructor=v,e(document).on("click.fileupload.data-api",'[data-provides="fileupload"]',function(l){var s=e(this);if(!s.data("fileupload")){s.fileupload(s.data());var r=e(l.target).closest('[data-dismiss="fileupload"],[data-trigger="fileupload"]');r.length>0&&(r.trigger("click.fileupload"),l.preventDefault())}})})(window.jQuery);(function(e){var v=new Array,l=new Array;e.fn.doAutosize=function(s){var r=e(this).data("minwidth"),a=e(this).data("maxwidth"),n="",d=e(this),t=e("#"+e(this).data("tester_id"));if(n!==(n=d.val())){var h=n.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">");t.html(h);var o=t.width(),f=o+s.comfortZone>=r?o+s.comfortZone:r,g=d.width(),u=f<g&&f>=r||f>r&&f<a;u&&d.width(f)}},e.fn.resetAutosize=function(s){var r=e(this).data("minwidth")||s.minInputWidth||e(this).width(),a=e(this).data("maxwidth")||s.maxInputWidth||e(this).closest(".tagsinput").width()-s.inputPadding,n=e(this),d=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:n.css("fontSize"),fontFamily:n.css("fontFamily"),fontWeight:n.css("fontWeight"),letterSpacing:n.css("letterSpacing"),whiteSpace:"nowrap"}),t=e(this).attr("id")+"_autosize_tester";!e("#"+t).length>0&&(d.attr("id",t),d.appendTo("body")),n.data("minwidth",r),n.data("maxwidth",a),n.data("tester_id",t),n.css("width",r)},e.fn.addTag=function(s,r){return r=jQuery.extend({focus:!1,callback:!0},r),this.each(function(){var a=e(this).attr("id"),n=e(this).val().split(v[a]);if(n[0]==""&&(n=new Array),s=jQuery.trim(s),r.unique){var d=e(n).tagExist(s);d==!0&&e("#"+a+"_tag").addClass("not_valid")}else var d=!1;if(s!=""&&d!=!0){if(e("<span>").addClass("tag").append(e("<span>").text(s).append("  "),e("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return e("#"+a).removeTag(escape(s))})).insertBefore("#"+a+"_addTag"),n.push(s),e("#"+a+"_tag").val(""),r.focus?e("#"+a+"_tag").focus():e("#"+a+"_tag").blur(),e.fn.tagsInput.updateTagsField(this,n),r.callback&&l[a]&&l[a].onAddTag){var t=l[a].onAddTag;t.call(this,s)}if(l[a]&&l[a].onChange){var h=n.length,t=l[a].onChange;t.call(this,e(this),n[h-1])}}}),!1},e.fn.removeTag=function(s){return s=unescape(s),this.each(function(){var r=e(this).attr("id"),a=e(this).val().split(v[r]);for(e("#"+r+"_tagsinput .tag").remove(),str="",i=0;i<a.length;i++)a[i]!=s&&(str=str+v[r]+a[i]);if(e.fn.tagsInput.importTags(this,str),l[r]&&l[r].onRemoveTag){var n=l[r].onRemoveTag;n.call(this,s)}}),!1},e.fn.tagExist=function(s){return jQuery.inArray(s,e(this))>=0},e.fn.importTags=function(s){id=e(this).attr("id"),e("#"+id+"_tagsinput .tag").remove(),e.fn.tagsInput.importTags(this,s)},e.fn.tagsInput=function(s){var r=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},s);return this.each(function(){r.hide&&e(this).hide();var a=e(this).attr("id");(!a||v[e(this).attr("id")])&&(a=e(this).attr("id","tags"+new Date().getTime()).attr("id"));var n=jQuery.extend({pid:a,real_input:"#"+a,holder:"#"+a+"_tagsinput",input_wrapper:"#"+a+"_addTag",fake_input:"#"+a+"_tag"},r);v[a]=n.delimiter,(r.onAddTag||r.onRemoveTag||r.onChange)&&(l[a]=new Array,l[a].onAddTag=r.onAddTag,l[a].onRemoveTag=r.onRemoveTag,l[a].onChange=r.onChange);var d='<div id="'+a+'_tagsinput" class="tagsinput"><div id="'+a+'_addTag">';if(r.interactive&&(d=d+'<input id="'+a+'_tag" value="" data-default="'+r.defaultText+'" />'),d=d+'</div><div class="tags_clear"></div></div>',e(d).insertAfter(this),e(n.holder).css("width",r.width),e(n.holder).css("height",r.height),e(n.real_input).val()!=""&&e.fn.tagsInput.importTags(e(n.real_input),e(n.real_input).val()),r.interactive){if(e(n.fake_input).val(e(n.fake_input).attr("data-default")),e(n.fake_input).css("color",r.placeholderColor),e(n.fake_input).resetAutosize(r),e(n.holder).bind("click",n,function(t){e(t.data.fake_input).focus()}),e(n.fake_input).bind("focus",n,function(t){e(t.data.fake_input).val()==e(t.data.fake_input).attr("data-default")&&e(t.data.fake_input).val(""),e(t.data.fake_input).css("color","#000000")}),r.autocomplete_url!=null){autocomplete_options={source:r.autocomplete_url};for(attrname in r.autocomplete)autocomplete_options[attrname]=r.autocomplete[attrname];jQuery.Autocompleter!==void 0?(e(n.fake_input).autocomplete(r.autocomplete_url,r.autocomplete),e(n.fake_input).bind("result",n,function(t,h,o){h&&e("#"+a).addTag(h[0]+"",{focus:!0,unique:r.unique})})):jQuery.ui.autocomplete!==void 0&&(e(n.fake_input).autocomplete(autocomplete_options),e(n.fake_input).bind("autocompleteselect",n,function(t,h){return e(t.data.real_input).addTag(h.item.value,{focus:!0,unique:r.unique}),!1}))}else e(n.fake_input).bind("blur",n,function(t){var h=e(this).attr("data-default");return e(t.data.fake_input).val()!=""&&e(t.data.fake_input).val()!=h?t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=e(t.data.fake_input).val().length)&&e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:r.unique}):(e(t.data.fake_input).val(e(t.data.fake_input).attr("data-default")),e(t.data.fake_input).css("color",r.placeholderColor)),!1});e(n.fake_input).bind("keypress",n,function(t){if(t.which==t.data.delimiter.charCodeAt(0)||t.which==13)return t.preventDefault(),t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=e(t.data.fake_input).val().length)&&e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:r.unique}),e(t.data.fake_input).resetAutosize(r),!1;t.data.autosize&&e(t.data.fake_input).doAutosize(r)}),n.removeWithBackspace&&e(n.fake_input).bind("keydown",function(t){if(t.keyCode==8&&e(this).val()==""){t.preventDefault();var h=e(this).closest(".tagsinput").find(".tag:last").text(),o=e(this).attr("id").replace(/_tag$/,"");h=h.replace(/[\s]+x$/,""),e("#"+o).removeTag(escape(h)),e(this).trigger("focus")}}),e(n.fake_input).blur(),n.unique&&e(n.fake_input).keydown(function(t){(t.keyCode==8||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&e(this).removeClass("not_valid")})}}),this},e.fn.tagsInput.updateTagsField=function(s,r){var a=e(s).attr("id");e(s).val(r.join(v[a]))},e.fn.tagsInput.importTags=function(s,r){e(s).val("");var a=e(s).attr("id"),n=r.split(v[a]);for(i=0;i<n.length;i++)e(s).addTag(n[i],{focus:!1,callback:!1});if(l[a]&&l[a].onChange){var d=l[a].onChange;d.call(s,s,n[i])}}})(jQuery);(function(){var e=window.jQuery;if(!e)return;var v="__sortableBridge";function l(a,n){var d=n||{},t=d.items||"> *",h=d.attribute||"id",o=d.key,f=d.expression||/(.+)[_=](.*)/,g=e(a).find(t).not(".sortable-ghost, .sortable-fallback"),u=[];return g.each(function(){var m=e(this).attr(h);if(m){var p=f.exec(m);if(p){var c=o||p[1]+"[]";u.push(encodeURIComponent(c)+"="+encodeURIComponent(p[2]))}}}),u.join("&")}function s(a){var n=e(a.item);return{item:n,helper:n,placeholder:e(a.clone||[]),sender:a.from?e(a.from):null,position:{left:a.originalEvent?a.originalEvent.pageX:0,top:a.originalEvent?a.originalEvent.pageY:0}}}function r(a,n){var d=window.Sortable;if(!d){console.warn("[sortableBridge] window.Sortable not available yet");return}var t=n||{},h=a[v];h&&h.instance&&h.instance.destroy();var o={animation:150,ghostClass:t.placeholder||"ui-state-highlight",chosenClass:"ui-sortable-helper",dragClass:"sortable-drag",forceFallback:!1,scroll:!0,scrollSensitivity:40,scrollSpeed:20};if(t.items&&(o.draggable=t.items),t.cancel&&(o.filter=t.cancel,o.preventOnFilter=!1),t.distance&&(o.fallbackTolerance=t.distance),t.connectWith){var f="sortable-bridge-"+t.connectWith.replace(/[^a-zA-Z0-9]/g,"");o.group=f}o.onStart=function(u){t.start&&t.start.call(a,u,s(u))},o.onEnd=function(u){t.stop&&t.stop.call(a,u,s(u))},o.onChange=function(u){t.change&&t.change.call(a,u,s(u))},o.onUpdate=function(u){t.update&&t.update.call(a,u,s(u))},o.onAdd=function(u){t.receive&&t.receive.call(a,u,s(u))},o.onRemove=function(u){t.remove&&t.remove.call(a,u,s(u))};var g=new d(a,o);a[v]={instance:g,options:t}}e.fn.sortable=function(a){if(typeof a=="string"){var n=Array.prototype.slice.call(arguments,1);if(a==="serialize"){var d=this[0];if(!d)return"";var t=d[v],h=n[0]||{};return t&&t.options&&t.options.items&&(h.items=h.items||t.options.items),l(d,h)}return this.each(function(){var o=this[v];if(!(!o||!o.instance))switch(a){case"refresh":break;case"destroy":o.instance.destroy(),delete this[v];break;case"disable":o.instance.option("disabled",!0);break;case"enable":o.instance.option("disabled",!1);break;case"option":n.length===2&&o.instance.option(n[0],n[1]);break}})}return this.each(function(){r(this,a)})}})();(function(){var e={allowedParents:{section:["root"],milestone:["section","milestone"],task:["section","milestone","task"],subtask:["task","subtask"]}};function v(o){return o&&o.dataset?o.dataset.itemType:null}function l(o){if(!o)return"root";if(o.dataset&&o.dataset.containerType)return o.dataset.containerType;if(o.dataset&&o.dataset.itemType)return o.dataset.itemType;var f=o.closest(".sortable-item");return f&&f.dataset.itemType||"root"}function s(o){return o&&o.dataset?o.dataset.project:null}function r(o,f){if(!o||!f)return!1;for(var g=f;g;){if(g===o)return!0;var u=g.parentElement?g.parentElement.closest(".sortable-item"):null;g=u}return!1}function a(o,f,g){var u=v(o),m=l(f);if(r(o,f))return!1;if(!g){var p=s(o),c=s(f);if(!c&&f&&f.parentElement){var w=f.parentElement.closest(".sortable-item");c=w?s(w):void 0}if(c!==void 0&&p!==c)return!1}var y=e.allowedParents[u];return!(!y||y.indexOf(m)===-1)}function n(o){var f=o.closest(".sortable-list[data-group-key]");return f?f.dataset.groupKey:null}function d(){var o=[],f="",g=document.getElementById("yourToDoContainer");g&&(f=g.dataset.groupBy||"");var u=[];f&&document.querySelectorAll(".sortable-item").forEach(function(c){var w=c.dataset.id,y=n(c),_=c.dataset.originalGroupKey;_&&y&&_!==y&&u.push({id:w,fromGroup:_,toGroup:y,groupBy:f})});function m(c,w,y){var _=c.querySelectorAll(":scope > .sortable-item");_.forEach(function(k,T){var $=k.dataset.id,b=n(k);o.push({id:$,parentId:w||null,parentType:l(k.parentElement),level:y,order:T,groupKey:b});var C=k.querySelector(":scope > .sortable-list");C&&m(C,$,y+1)})}if(document.querySelectorAll(".sortable-list").forEach(function(c){(!c.parentElement||!c.parentElement.closest(".sortable-list"))&&m(c,null,0)}),o.length>0){var p={};o.forEach(function(c,w){p[w]=JSON.stringify(c)}),u.length>0&&(u.forEach(function(c,w){p["groupChanges["+w+"]"]=JSON.stringify(c)}),p.groupBy=f),htmx.ajax("POST",leantime.appUrl+"/hx/widgets/myToDos/saveSorting",{target:"#htmx-indicator",swap:"none",values:p})}}function t(o){if(o){var f=o.classList.contains("sortable-list")?[o]:Array.from(o.querySelectorAll(".sortable-list"));o.classList.contains("sortable-list")&&f.indexOf(o)===-1&&f.push(o),f.forEach(function(g){g._sortableInstance&&g._sortableInstance.destroy(),g._sortableInstance=new Sortable(g,{group:"nested-sortable",animation:150,fallbackOnBody:!0,swapThreshold:.65,delay:150,delayOnTouchOnly:!0,draggable:".sortable-item",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",handle:".sortable-item",filter:".no-drag",forceFallback:!1,scroll:!0,scrollSensitivity:40,scrollSpeed:20,onStart:function(u){var m=u.item;document.querySelectorAll(".sortable-item").forEach(function(p){p.dataset.originalGroupKey||(p.dataset.originalGroupKey=n(p)||"")}),m.dataset.originalGroupKey=n(m)||"",m.dataset.startParentId=m.parentElement&&m.parentElement.id||""},onMove:function(u){var m=u.dragged,p=u.to;return a(m,p,!1)?(document.querySelectorAll(".highlight-drop-error").forEach(function(c){c.classList.remove("highlight-drop-error")}),document.querySelectorAll(".highlight-drop").forEach(function(c){c.classList.remove("highlight-drop")}),p.classList.add("highlight-drop"),!0):(p.classList.add("highlight-drop-error"),!1)},onEnd:function(u){var m=u.item;document.querySelectorAll(".highlight-drop, .highlight-drop-error").forEach(function(y){y.classList.remove("highlight-drop"),y.classList.remove("highlight-drop-error")}),document.querySelectorAll(".pomodoro-drop-target").forEach(function(y){y.classList.remove("pomodoro-drop-target")});var p=m.parentElement;if(!(!p||!p.classList.contains("sortable-list"))){if(!a(m,p,!0)){var c=document.getElementById(m.dataset.startParentId);c&&c.appendChild(m);var w="Nesting not allowed here";typeof leantime<"u"&&leantime.toast&&leantime.toast.show({message:w,style:"error"});return}setTimeout(function(){document.querySelectorAll(".sortable-list").forEach(function(y){if(y.querySelectorAll(":scope > .sortable-item").length===0){var _=y.parentElement;if(_&&_.classList.contains("sortable-item")){var k=_.querySelector(".accordion-toggle");k&&k.remove()}}})},300),d(),document.querySelectorAll(".sortable-item").forEach(function(y){delete y.dataset.originalGroupKey})}}})})}}var h=window.leantime||(window.leantime={});h.nestedSortable={init:t,saveSorting:d,isNestingAllowed:a},typeof jQuery<"u"&&(jQuery.fn.nestedSortable=function(){return this.each(function(){t(this)})})})();const x=window.jQuery;window.$=x;window.autocomplete_options=window.autocomplete_options||{};window.attrname=window.attrname||"";window.i=window.i||0;window.str=window.str||"";
