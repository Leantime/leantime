leantime.ideasController=function(){var s=!1,d=function(){return{sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),s==!0&&(s=!1,location.reload())},afterShowCont:function(){jQuery(".ideaModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(d())}}}},u=function(){jQuery(".ideaModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(d())},c=function(e){jQuery.nmManual(e,d)},p=function(){var e=jQuery("#ideaMason").packery({itemSelector:".ticketBox",columnWidth:260,isResizable:!0});e.imagesLoaded().progress(function(){e.packery("layout")});var r=e.find(".ticketBox").draggable({start:function(n,a){a.helper.addClass("tilt"),t(a.helper)},stop:function(n,a){a.helper.removeClass("tilt"),jQuery("html").unbind("mousemove",a.helper.data("move_handler")),a.helper.removeData("move_handler")}});function t(n){var a=n.position().left,i=function(l){l.pageX>=a?(n.addClass("right"),n.removeClass("left")):(n.addClass("left"),n.removeClass("right")),a=l.pageX};jQuery("html").bind("mousemove",i),n.data("move_handler",i)}e.packery("bindUIDraggableEvents",r);function o(){var n=[],a=e.packery("getItemElements");jQuery(a).each(function(i,l){var b=i+1,M=jQuery(l).attr("data-value");n.push({id:M,sortIndex:b})}),jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/ideas",data:{action:"ideaSort",payload:n}})}e.on("dragItemPositioned",o)},m=function(){},h=function(){jQuery(".mainIdeaContent img").each(function(){jQuery(this).wrap("<a href='"+jQuery(this).attr("src")+"' class='imageModal'></a>")}),jQuery(".imageModal").nyroModal()},f=function(e){e=="existing"&&(jQuery("#newMilestone, #milestoneSelectors").hide("fast"),jQuery("#existingMilestone").show(),u()),e=="new"&&(jQuery("#newMilestone").show(),jQuery("#existingMilestone, #milestoneSelectors").hide("fast"),u()),e=="hide"&&(jQuery("#newMilestone, #existingMilestone").hide("fast"),jQuery("#milestoneSelectors").show("fast"))},y=function(){s=!0},v=function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("_");if(jQuery(this).attr("data-label"),e.length==3){var r=e[0],t=e[1];e[2],jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/ideas",data:{id:r,author:t}}).done(function(){jQuery("#userDropdownMenuLink"+r+" span.text span#userImage"+r+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+t),jQuery.growl({message:leantime.i18n.__("short_notifications.user_updated")})})}})},g=function(){jQuery("body").on("click",".statusDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("_"),r=jQuery(this).attr("data-label");if(e.length==3){var t=e[0],o=e[1],n=e[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/ideas",data:{id:t,box:o}}).done(function(){jQuery("#statusDropdownMenuLink"+t+" span.text").text(r),jQuery("#statusDropdownMenuLink"+t).removeClass().addClass(""+n+" dropdown-toggle f-left status "),jQuery.growl({message:leantime.i18n.__("short_notifications.status_updated")})})}})},j=function(){var e=jQuery("html").height()-320;jQuery("#sortableIdeaKanban .column .contentInner").css("height",e)},Q=function(e){jQuery("#sortableIdeaKanban").disableSelection(),jQuery("#sortableIdeaKanban .ticketBox").hover(function(){jQuery(this).css("background","var(--kanban-card-hover)")},function(){jQuery(this).css("background","var(--kanban-card-bg)")}),jQuery("#sortableIdeaKanban .contentInner").sortable({connectWith:".contentInner",items:"> .moveable",tolerance:"pointer",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,cancel:".portlet-toggle",start:function(t,o){o.item.addClass("tilt"),r(o.item)},stop:function(t,o){o.item.removeClass("tilt"),jQuery("html").unbind("mousemove",o.item.data("move_handler")),o.item.removeData("move_handler")},update:function(t,o){for(var n={action:"statusUpdate",payload:{}},a=0;a<e.length;a++)jQuery(".contentInner.status_"+e[a]).length&&(n.payload[e[a]]=jQuery(".contentInner.status_"+e[a]).sortable("serialize"));jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/ideas",data:n})}});function r(t){var o=t.position().left,n=function(a){a.pageX>=o?(t.addClass("right"),t.removeClass("left")):(t.addClass("left"),t.removeClass("right")),o=a.pageX};jQuery("html").bind("mousemove",n),t.data("move_handler",n)}jQuery(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>"),jQuery(".portlet-toggle").click(function(){var t=jQuery(this);t.toggleClass("ui-icon-minusthick ui-icon-plusthick"),t.closest(".portlet").find(".portlet-content").toggle()})};return{setCloseModal:y,toggleMilestoneSelectors:f,openModalManually:c,initMasonryWall:p,initBoardControlModal:m,initWallImageModals:h,initUserDropdown:v,initStatusDropdown:g,setKanbanHeights:j,initIdeaKanban:Q}}();
