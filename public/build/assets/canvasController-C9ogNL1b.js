leantime.canvasController=function(){var u="",b=function(e){u=e},E=function(){window.addEventListener("load",function(){document.querySelectorAll(".loading").forEach(function(e){e.style.display="none"}),document.querySelectorAll(".filterBar .row-fluid").forEach(function(e){e.style.opacity="1"})})},A=function(){jQuery(".addCanvasLink").nyroModal(),document.querySelectorAll(".editCanvasLink").forEach(function(e){e.addEventListener("click",function(){jQuery("#editCanvas").modal("show")})}),document.querySelectorAll(".cloneCanvasLink").forEach(function(e){e.addEventListener("click",function(){jQuery("#cloneCanvas").modal("show")})}),document.querySelectorAll(".mergeCanvasLink").forEach(function(e){e.addEventListener("click",function(){jQuery("#mergeCanvas").modal("show")})}),document.querySelectorAll(".importCanvasLink").forEach(function(e){e.addEventListener("click",function(){jQuery("#importCanvas").modal("show")})})},h=!1,w={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(e){e.style.display=""}),h==!0&&(h=!1,location.reload())},afterShowCont:function(){window.htmx.process("#global-modal-content"),jQuery("."+u+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+u+"CanvasMilestone .deleteMilestone").nyroModal(w)},beforeClose:function(){location.reload()}},titleFromIframe:!0},M=function(){jQuery("."+u+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+u+"CanvasMilestone .deleteMilestone").nyroModal(w)},L=function(e){jQuery.nmManual(e,w)},q=function(e){if(e=="existing"){document.querySelectorAll("#newMilestone, #milestoneSelectors").forEach(function(o){o.style.display="none"});var t=document.getElementById("existingMilestone");t&&(t.style.display=""),M()}if(e=="new"){var n=document.getElementById("newMilestone");n&&(n.style.display=""),document.querySelectorAll("#existingMilestone, #milestoneSelectors").forEach(function(o){o.style.display="none"}),M()}if(e=="hide"){document.querySelectorAll("#newMilestone, #existingMilestone").forEach(function(o){o.style.display="none"});var l=document.getElementById("milestoneSelectors");l&&(l.style.display="")}},x=function(){h=!0},g=function(){document.body.addEventListener("click",function(e){var t=e.target.closest(".userDropdown .dropdown-menu a");if(t){var n=t.getAttribute("data-value").split("_");if(t.getAttribute("data-label"),n.length==3){var l=n[0],o=n[1];n[2],fetch(leantime.appUrl+"/api/"+u+"canvas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:l,author:o})}).then(function(){var i=document.querySelector("#userDropdownMenuLink"+l+" span.text span#userImage"+l+" img");i&&i.setAttribute("src",leantime.appUrl+"/api/users?profileImage="+o),leantime.toast.show({message:leantime.i18n.__("short_notifications.user_updated"),style:"success"})})}}})},C=function(){document.body.addEventListener("click",function(e){var t=e.target.closest(".statusDropdown .dropdown-menu a");if(t){var n=t.getAttribute("data-value").split("/"),l=t.getAttribute("data-label");if(n.length==2){var o=n[0],i=n[1],d=t.getAttribute("class");fetch(leantime.appUrl+"/api/"+u+"canvas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:o,status:i})}).then(function(){var f=document.querySelector("#statusDropdownMenuLink"+o+" span.text");f&&(f.textContent=l);var s=document.getElementById("statusDropdownMenuLink"+o);s&&(s.className=d+" dropdown-toggle f-left status "),leantime.toast.show({message:leantime.i18n.__("short_notifications.status_updated")})})}}})},S=function(){document.body.addEventListener("click",function(e){var t=e.target.closest(".relatesDropdown .dropdown-menu a");if(t){var n=t.getAttribute("data-value").split("/"),l=t.getAttribute("data-label");if(n.length==2){var o=n[0],i=n[1],d=t.getAttribute("class");fetch(leantime.appUrl+"/api/"+u+"canvas",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({id:o,relates:i})}).then(function(){var f=document.querySelector("#relatesDropdownMenuLink"+o+" span.text");f&&(f.textContent=l);var s=document.getElementById("relatesDropdownMenuLink"+o);s&&(s.className=d+" dropdown-toggle f-left relates "),leantime.toast.show({message:leantime.i18n.__("short_notifications.relates_updated")})})}}})},k=function(e,t){t=t||{};var n=e,l=!1,o=function(){return{sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){document.querySelectorAll(".showDialogOnLoad").forEach(function(a){a.style.display=""}),l&&(l=!1,location.reload())},afterShowCont:function(){window.htmx.process("#global-modal-content"),jQuery("."+n+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+n+"CanvasMilestone .deleteMilestone").nyroModal(o())},beforeClose:function(){location.reload()}},titleFromIframe:!0}},i=function(){jQuery("."+n+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+n+"CanvasMilestone .deleteMilestone").nyroModal(o())},d;t.rowSelectors&&t.rowSelectors.length>0?d=function(){t.rowSelectors.forEach(function(a){var c=0;document.querySelectorAll("#"+a+" div.contentInner").forEach(function(r){r.offsetHeight>c&&(c=r.offsetHeight+35)}),document.querySelectorAll("#"+a+" .column .contentInner").forEach(function(r){r.style.height=c+"px"})})}:t.nbRows&&t.nbRows>0?d=function(){var a=t.nbRows,c=["firstRow","secondRow","thirdRow","fourthRow"],r=document.documentElement.offsetHeight-320-20*a;a===2&&(r-=25);for(var y=0;y<a&&y<c.length;y++){var m="#"+c[y],v=r/a;a>=3&&(v=r*.333),document.querySelectorAll(m+" div.contentInner").forEach(function(p){p.offsetHeight>v&&(v=p.offsetHeight+50)}),document.querySelectorAll(m+" .column .contentInner").forEach(function(p){p.style.height=v+"px"})}}:d=function(){};var f={setCloseModal:function(){l=!0},toggleMilestoneSelectors:function(a){if(a=="existing"){document.querySelectorAll("#newMilestone, #milestoneSelectors").forEach(function(m){m.style.display="none"});var c=document.getElementById("existingMilestone");c&&(c.style.display=""),i()}if(a=="new"){var r=document.getElementById("newMilestone");r&&(r.style.display=""),document.querySelectorAll("#existingMilestone, #milestoneSelectors").forEach(function(m){m.style.display="none"}),i()}if(a=="hide"){document.querySelectorAll("#newMilestone, #existingMilestone").forEach(function(m){m.style.display="none"});var y=document.getElementById("milestoneSelectors");y&&(y.style.display="")}},openModalManually:function(a){jQuery.nmManual(a,o)},initUserDropdown:g,initStatusDropdown:C,initRelatesDropdown:S,setRowHeights:d};if(t.extras)for(var s in t.extras)t.extras.hasOwnProperty(s)&&(f[s]=t.extras[s]);return f};return{setCanvasName:b,initFilterBar:E,initCanvasLinks:A,initUserDropdown:g,initStatusDropdown:C,initRelatesDropdown:S,setCloseModal:x,toggleMilestoneSelectors:q,openModalManually:L,createController:k}}();
