leantime.dbmCanvasController=function(){var r="dbm",c=function(){var e=3,n=jQuery("html").height()-320-20*e,t=n*.375;jQuery("#firstRow div.contentInner").each(function(){jQuery(this).height()>t&&(t=jQuery(this).height()+50)});var o=n*.375;jQuery("#secondRow div.contentInner").each(function(){jQuery(this).height()>o&&(o=jQuery(this).height()+50)});var a=o*.5;jQuery("#secondRowTop div.contentInner").each(function(){jQuery(this).height()>a&&(a=jQuery(this).height()+50)});var i=o*.5;jQuery("#secondRowBottom div.contentInner").each(function(){jQuery(this).height()>i&&(i=jQuery(this).height()+50)}),a+i+25>o&&(o=a+i+50);var u=n*.25;jQuery("#thirdRow div.contentInner").each(function(){jQuery(this).height()>u&&(u=jQuery(this).height()+50)}),jQuery("#firstRow .column .contentInner").css("height",t),jQuery("#secondRow .column .contentInner").css("height",o),jQuery("#secondRowTop .column .contentInner").css("height",a),jQuery("#secondRowBottom .column .contentInner").css("height",i),jQuery("#thirdRow .column .contentInner").css("height",u)},s=!1,l=function(){return{sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),s==!0&&(s=!1,location.reload())},afterShowCont:function(){window.htmx.process("#global-modal-content"),jQuery("."+r+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+r+"CanvasMilestone .deleteMilestone").nyroModal(l())},beforeClose:function(){location.reload()}},titleFromIframe:!0}},d=function(){jQuery("."+r+"CanvasModal, #commentForm, #commentForm .deleteComment, ."+r+"CanvasMilestone .deleteMilestone").nyroModal(l())},h=function(e){jQuery.nmManual(e,l)},y=function(e){e=="existing"&&(jQuery("#newMilestone, #milestoneSelectors").hide("fast"),jQuery("#existingMilestone").show(),d()),e=="new"&&(jQuery("#newMilestone").show(),jQuery("#existingMilestone, #milestoneSelectors").hide("fast"),d()),e=="hide"&&(jQuery("#newMilestone, #existingMilestone").hide("fast"),jQuery("#milestoneSelectors").show("fast"))},f=function(){s=!0},j=function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("_");if(jQuery(this).attr("data-label"),e.length==3){var n=e[0],t=e[1];e[2],jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/"+r+"canvas",data:{id:n,author:t}}).done(function(){jQuery("#userDropdownMenuLink"+n+" span.text span#userImage"+n+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+t),jQuery.growl({message:leantime.i18n.__("short_notifications.user_updated"),style:"success"})})}})},w=function(){jQuery("body").on("click",".statusDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("/"),n=jQuery(this).attr("data-label");if(e.length==2){var t=e[0],o=e[1],a=jQuery(this).attr("class");jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/"+r+"canvas",data:{id:t,status:o}}).done(function(){jQuery("#statusDropdownMenuLink"+t+" span.text").text(n),jQuery("#statusDropdownMenuLink"+t).removeClass().addClass(a+" dropdown-toggle f-left status "),jQuery.growl({message:leantime.i18n.__("short_notifications.status_updated")})})}})},m=function(){jQuery("body").on("click",".relatesDropdown .dropdown-menu a",function(){var e=jQuery(this).attr("data-value").split("/"),n=jQuery(this).attr("data-label");if(e.length==2){var t=e[0],o=e[1],a=jQuery(this).attr("class");jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/"+r+"canvas",data:{id:t,relates:o}}).done(function(){jQuery("#relatesDropdownMenuLink"+t+" span.text").text(n),jQuery("#relatesDropdownMenuLink"+t).removeClass().addClass(a+" dropdown-toggle f-left relates "),jQuery.growl({message:leantime.i18n.__("short_notifications.relates_updated")})})}})};return{setCloseModal:f,toggleMilestoneSelectors:y,openModalManually:h,initUserDropdown:j,initStatusDropdown:w,initRelatesDropdown:m,setRowHeights:c}}();
