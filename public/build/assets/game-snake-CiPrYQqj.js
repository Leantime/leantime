var s=s||{};window.SNAKE=s;s.addEventListener=function(){if(window.addEventListener)return function(m,p,f,r){m.addEventListener(p,f,r)};if(window.attachEvent)return function(m,p,f){m.attachEvent("on"+p,f)}}();s.removeEventListener=function(){if(window.removeEventListener)return function(m,p,f,r){m.removeEventListener(p,f,r)};if(window.detachEvent)return function(m,p,f){m.detachEvent("on"+p,f)}}();s.Snake=s.Snake||function(){var m=[],p=function(){this.elm=null,this.elmStyle=null,this.row=-1,this.col=-1,this.xPos=-1e3,this.yPos=-1e3,this.next=null,this.prev=null};function f(r){var e=0,t=0,c;for(c in r)r[c].elm.currentStyle?t=parseFloat(r[c].elm.style["z-index"],10):window.getComputedStyle&&(t=parseFloat(document.defaultView.getComputedStyle(r[c].elm,null).getPropertyValue("z-index"),10)),!isNaN(t)&&t>e&&(e=t);return e+1}return function(r){if(!r||!r.playingBoard)return;localStorage.jsSnakeHighScore===void 0&&localStorage.setItem("jsSnakeHighScore",0);var e=this,t=r.playingBoard,c=5,o=1,h=-1,B=!0,H=!0,E=-1,O=[0,1,0,-1],T=[-1,0,1,0],k=[],N=[],g=80,M=!1,d=!1,y=document.getElementById("selectMode");y&&y.addEventListener("change",function(a){a=a||{};var n=a.target?parseInt(a.target.value):75;(isNaN(n)||n<25)&&(n=75),g=n,setTimeout(function(){document.getElementById("game-area").focus()},10)}),e.snakeBody={},e.snakeBody.b0=new p,e.snakeBody.b0.row=r.startRow||1,e.snakeBody.b0.col=r.startCol||1,e.snakeBody.b0.xPos=e.snakeBody.b0.row*t.getBlockWidth(),e.snakeBody.b0.yPos=e.snakeBody.b0.col*t.getBlockHeight(),e.snakeBody.b0.elm=b(),e.snakeBody.b0.elmStyle=e.snakeBody.b0.elm.style,t.getBoardContainer().appendChild(e.snakeBody.b0.elm),e.snakeBody.b0.elm.style.left=e.snakeBody.b0.xPos+"px",e.snakeBody.b0.elm.style.top=e.snakeBody.b0.yPos+"px",e.snakeBody.b0.next=e.snakeBody.b0,e.snakeBody.b0.prev=e.snakeBody.b0,e.snakeLength=1,e.snakeHead=e.snakeBody.b0,e.snakeTail=e.snakeBody.b0,e.snakeHead.elm.className=e.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),e.snakeHead.elm.id="snake-snakehead-alive",e.snakeHead.elm.className+=" snake-snakebody-alive";function b(){var a=document.createElement("div");return a.className="snake-snakebody-block",a.style.left="-1000px",a.style.top="-1000px",a.style.width=t.getBlockWidth()+"px",a.style.height=t.getBlockHeight()+"px",a}function S(a){for(var n,i=b(),v=1;v<a;v++)n=new p,n.elm=i.cloneNode(!0),n.elmStyle=n.elm.style,t.getBoardContainer().appendChild(n.elm),m[m.length]=n;n=new p,n.elm=i,t.getBoardContainer().appendChild(n.elm),m[m.length]=n}function L(){var a=localStorage.jsSnakeHighScore;e.snakeLength>a&&(alert("Congratulations! You have beaten your previous high score, which was "+a+"."),localStorage.setItem("jsSnakeHighScore",e.snakeLength))}function G(a){L(),e.snakeHead.elm.style.zIndex=f(e.snakeBody),e.snakeHead.elm.className=e.snakeHead.elm.className.replace(/\bsnake-snakebody-alive\b/,""),e.snakeHead.elm.className+=" snake-snakebody-dead",M=!0,a()}e.setPaused=function(a){d=a},e.getPaused=function(){return d},e.handleArrowKeys=function(a){if(M||d&&!r.premoveOnPause)return;e.snakeLength;let n=-1;switch(a){case 37:case 65:n=3;break;case 38:case 87:n=0;break;case 39:case 68:n=1;break;case 40:case 83:n=2;break}E!==o&&(h=n),(Math.abs(n-o)!==2&&(B||d)||H)&&(E=n,B=!1,H=!1)},e.go=function(){var a=e.snakeHead,n=e.snakeTail,i=t.grid;if(d===!0){setTimeout(function(){e.go()},g);return}if(e.snakeTail=n.prev,e.snakeHead=n,i[n.row]&&i[n.row][n.col]&&(i[n.row][n.col]=0),E!==-1&&(o=E,h!==-1&&(E=h,h=-1)),B=!0,n.col=a.col+O[o],n.row=a.row+T[o],n.xPos=a.xPos+k[o],n.yPos=a.yPos+N[o],n.elmStyle||(n.elmStyle=n.elm.style),n.elmStyle.left=n.xPos+"px",n.elmStyle.top=n.yPos+"px",e.snakeLength>1&&(n.elm.id="snake-snakehead-alive",a.elm.id=""),i[n.row][n.col]===0)i[n.row][n.col]=1,setTimeout(function(){e.go()},g);else if(i[n.row][n.col]>0)e.handleDeath();else if(i[n.row][n.col]===t.getGridFoodValue()){if(i[n.row][n.col]=1,!e.eatFood()){e.handleWin();return}setTimeout(function(){e.go()},g)}},e.eatFood=function(){m.length<=c&&S(c*2);for(var a=m.splice(0,c),n=a.length,i,v=e.snakeTail;n--;)i="b"+e.snakeLength++,e.snakeBody[i]=a[n],e.snakeBody[i].prev=v,e.snakeBody[i].elm.className=e.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),e.snakeBody[i].elm.className+=" snake-snakebody-alive",v.next=e.snakeBody[i],v=e.snakeBody[i];if(e.snakeTail=e.snakeBody[i],e.snakeTail.next=e.snakeHead,e.snakeHead.prev=e.snakeTail,!t.foodEaten())return!1;var K=document.getElementById("selectMode"),U=K.options[K.selectedIndex];return U.text.localeCompare("Rush")==0&&(g>30?g-=5:g=30),!0},e.handleDeath=function(){var a=document.getElementById("selectMode").value;g=parseInt(a),G(t.handleDeath)},e.handleWin=function(){G(t.handleWin)},e.rebirth=function(){M=!1,B=!0,H=!0,h=-1},e.reset=function(){if(M!==!1){for(var a=[],n=e.snakeHead.next,i;n!==e.snakeHead;)i=n.next,n.prev=null,n.next=null,a.push(n),n=i;e.snakeHead.next=e.snakeHead,e.snakeHead.prev=e.snakeHead,e.snakeTail=e.snakeHead,e.snakeLength=1;for(var v=0;v<a.length;v++)a[v].elm.style.left="-1000px",a[v].elm.style.top="-1000px",a[v].elm.className=e.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a[v].elm.className+=" snake-snakebody-alive";m.concat(a),e.snakeHead.elm.className=e.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),e.snakeHead.elm.className+=" snake-snakebody-alive",e.snakeHead.elm.id="snake-snakehead-alive",e.snakeHead.row=r.startRow||1,e.snakeHead.col=r.startCol||1,e.snakeHead.xPos=e.snakeHead.row*t.getBlockWidth(),e.snakeHead.yPos=e.snakeHead.col*t.getBlockHeight(),e.snakeHead.elm.style.left=e.snakeHead.xPos+"px",e.snakeHead.elm.style.top=e.snakeHead.yPos+"px"}},S(c*2),k[0]=0,k[1]=t.getBlockWidth(),k[2]=0,k[3]=-1*t.getBlockWidth(),N[0]=-1*t.getBlockHeight(),N[1]=0,N[2]=t.getBlockHeight(),N[3]=0}}();s.Food=s.Food||function(){var m=0;function p(f,r){return Math.floor(Math.random()*(r+1-f))+f}return function(f){if(!(!f||!f.playingBoard)){var r=this,e=f.playingBoard,t,c,o=m++,h=document.createElement("div");h.setAttribute("id","snake-food-"+o),h.className="snake-food-block",h.style.width=e.getBlockWidth()+"px",h.style.height=e.getBlockHeight()+"px",h.style.left="-1000px",h.style.top="-1000px",e.getBoardContainer().appendChild(h),r.getFoodElement=function(){return h},r.randomlyPlaceFood=function(){e.grid[t]&&e.grid[t][c]===e.getGridFoodValue()&&(e.grid[t][c]=0);for(var B=0,H=0,E=0,O=e.grid.length-1,T=e.grid[0].length-1;e.grid[B][H]!==0;)if(B=p(1,O),H=p(1,T),E++,E>2e4)return!1;return e.grid[B][H]=e.getGridFoodValue(),t=B,c=H,h.style.top=B*e.getBlockHeight()+"px",h.style.left=H*e.getBlockWidth()+"px",!0}}}}();s.Board=s.Board||function(){var m=0;function p(e){var t=0,c=0,o;for(o in e)e[o].elm.currentStyle?c=parseFloat(e[o].elm.style["z-index"],10):window.getComputedStyle&&(c=parseFloat(document.defaultView.getComputedStyle(e[o].elm,null).getPropertyValue("z-index"),10)),!isNaN(c)&&c>t&&(t=c);return t+1}function f(){var e=0;return typeof window.innerWidth=="number"?e=window.innerWidth:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientWidth:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth),e}function r(){var e=0;return typeof window.innerHeight=="number"?e=window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientHeight),e}return function(e){var t=this,c=m++,o=e||{},h=250,B=250,H=20,E=20,O=-1,T,k,N=1,g,M=!1,d,y,b,S,L,G,a,n,i;t.grid=[];function v(){y=document.createElement("div"),y.setAttribute("id","playingField"),y.className="snake-playing-field",s.addEventListener(y,"click",function(){d.focus()},!1),i=document.createElement("div"),i.className="snake-pause-screen",i.innerHTML="<div style='padding:10px;'>[Paused]<p/>Press [space] to unpause.</div>",b=document.createElement("div"),b.className="snake-panel-component",b.innerHTML="<a href='http://patorjk.com/blog/software/' class='snake-link'>more patorjk.com apps</a> - <a href='https://github.com/patorjk/JavaScript-Snake' class='snake-link'>source code</a> - <a href='https://www.youtube.com/channel/UCpcCLm9y6CsjHUrCvJHYHUA' class='snake-link'>pat's youtube</a>",S=document.createElement("div"),S.className="snake-panel-component",S.innerHTML="Length: 1",L=document.createElement("div"),L.className="snake-panel-component",L.innerHTML="Highscore: "+(localStorage.jsSnakeHighScore||0),G=q(),a=Q(),n=$(),s.addEventListener(d,"keyup",function(u){if(!u)var u=window.event;return u.cancelBubble=!0,u.stopPropagation&&u.stopPropagation(),u.preventDefault&&u.preventDefault(),!1},!1),d.className="snake-game-container",i.style.zIndex=1e4,d.appendChild(i),d.appendChild(y),d.appendChild(b),d.appendChild(S),d.appendChild(L),d.appendChild(G),d.appendChild(a),d.appendChild(n),k=new s.Snake({playingBoard:t,startRow:2,startCol:2,premoveOnPause:o.premoveOnPause}),T=new s.Food({playingBoard:t}),G.style.zIndex=1e3}function K(){return h*t.getBlockWidth()}function U(){return B*t.getBlockHeight()}function q(){var l=document.createElement("div");l.id="sbWelcome"+c,l.className="snake-welcome-dialog";var u=document.createElement("div"),I="";o.fullScreen&&(I="On Windows, press F11 to play in Full Screen mode."),u.innerHTML="JavaScript Snake<p></p>Use the <strong>arrow keys</strong> on your keyboard to play the game. "+I+"<p></p>";var w=document.createElement("button");w.appendChild(document.createTextNode("Play Game"));var A=function(){s.removeEventListener(window,"keyup",W,!1),l.style.display="none",t.setBoardState(1),t.getBoardContainer().focus()},W=function(x){if(!x)var x=window.event;var _=x.which?x.which:x.keyCode;(_===32||_===13)&&A()};return s.addEventListener(window,"keyup",W,!1),s.addEventListener(w,"click",A,!1),l.appendChild(u),l.appendChild(w),l}function J(l,u,I){var w=document.createElement("div");w.id=u+c,w.className=I;var A=document.createElement("div");A.innerHTML="JavaScript Snake<p></p>"+l+"<p></p>";var W=document.createElement("button");W.appendChild(document.createTextNode("Play Again?"));var z=function(){w.style.display="none",t.resetBoard(),t.setBoardState(1),t.getBoardContainer().focus()},x=function(F){if(!(N!==0||w.style.display!=="block")){if(!F)var F=window.event;var j=F.which?F.which:F.keyCode;(j===32||j===13)&&z()}};return s.addEventListener(window,"keyup",x,!0),s.addEventListener(W,"click",z,!1),w.appendChild(A),w.appendChild(W),w}function Q(){return J("You died :(","sbTryAgain","snake-try-again-dialog")}function $(){return J("You win! :D","sbWin","snake-win-dialog")}function Y(l){var u=Math.max(p(k.snakeBody),p({tmp:{elm:T.getFoodElement()}}));d.removeChild(l),d.appendChild(l),l.style.zIndex=u,l.style.display="block",t.setBoardState(0)}t.setPaused=function(l){M=l,k.setPaused(l),M?i.style.display="block":i.style.display="none"},t.getPaused=function(){return M},t.resetBoard=function(){s.removeEventListener(d,"keydown",g,!1),k.reset(),S.innerHTML="Length: 1",t.setupPlayingField()},t.getBoardState=function(){return N},t.setBoardState=function(l){N=l},t.getGridFoodValue=function(){return O},t.getPlayingFieldElement=function(){return y},t.setBoardContainer=function(l){typeof l=="string"&&(l=document.getElementById(l)),l!==d&&(d=l,y=null,t.setupPlayingField())},t.getBoardContainer=function(){return d},t.getBlockWidth=function(){return H},t.getBlockHeight=function(){return E},t.setupPlayingField=function(){y||v();var l,u,I,w;o.fullScreen===!0?(I=0,w=0,l=f()-20,u=r()-20):(I=o.top,w=o.left,l=o.width,u=o.height);var A=t.getBlockWidth()*2+l%t.getBlockWidth(),W=Math.min(K()-A,l-A),z=t.getBlockHeight()*3+u%t.getBlockHeight(),x=Math.min(U()-z,u-z);d.style.left=w+"px",d.style.top=I+"px",d.style.width=l+"px",d.style.height=u+"px",y.style.left=t.getBlockWidth()+"px",y.style.top=t.getBlockHeight()+"px",y.style.width=W+"px",y.style.height=x+"px";var _=z-t.getBlockHeight(),F=t.getBlockHeight()+x+Math.round((_-30)/2)+"px";b.style.top=F,b.style.width="450px",b.style.left=Math.round(l/2)-Math.round(450/2)+"px",S.style.top=F,S.style.left="30px",L.style.top=F,L.style.left=l-140+"px",l<700?b.style.display="none":b.style.display="block",t.grid=[];for(var j=W/t.getBlockWidth()+2,X=x/t.getBlockHeight()+2,D=0;D<X;D++){t.grid[D]=[];for(var V=0;V<j;V++)V===0||D===0||V===j-1||D===X-1?t.grid[D][V]=1:t.grid[D][V]=0}T.randomlyPlaceFood(),g=function(P){if(!P)var P=window.event;var R=P.which?P.which:P.keyCode;if(t.getBoardState()===1){if(!(R>=37&&R<=40)&&!(R===87||R===65||R===83||R===68))return;s.removeEventListener(d,"keydown",g,!1),g=function(C){if(!C)var C=window.event;var Z=C.which?C.which:C.keyCode;return Z===32&&t.getBoardState()!=0&&t.setPaused(!t.getPaused()),k.handleArrowKeys(Z),C.cancelBubble=!0,C.stopPropagation&&C.stopPropagation(),C.preventDefault&&C.preventDefault(),!1},s.addEventListener(d,"keydown",g,!1),k.rebirth(),k.handleArrowKeys(R),t.setBoardState(2),k.go()}return P.cancelBubble=!0,P.stopPropagation&&P.stopPropagation(),P.preventDefault&&P.preventDefault(),!1},s.addEventListener(d,"keydown",g,!1)},t.foodEaten=function(){return S.innerHTML="Length: "+k.snakeLength,k.snakeLength>localStorage.jsSnakeHighScore&&(localStorage.setItem("jsSnakeHighScore",k.snakeLength),L.innerHTML="Highscore: "+localStorage.jsSnakeHighScore),!!T.randomlyPlaceFood()},t.handleDeath=function(){Y(a)},t.handleWin=function(){Y(n)},o.fullScreen=typeof o.fullScreen>"u"?!1:o.fullScreen,o.top=typeof o.top>"u"?0:o.top,o.left=typeof o.left>"u"?0:o.left,o.width=typeof o.width>"u"?400:o.width,o.height=typeof o.height>"u"?400:o.height,o.premoveOnPause=typeof o.premoveOnPause>"u"?!1:o.premoveOnPause,o.fullScreen&&s.addEventListener(window,"resize",function(){t.setupPlayingField()},!1),t.setBoardState(0),o.boardContainer&&t.setBoardContainer(o.boardContainer)}}();
